{"ast":null,"code":"'use strict'; // based on https://developers.google.com/speed/webp/docs/riff_container\n\nfunction isWebP(buffer) {\n  var riffHeader = 'RIFF' === buffer.toString('ascii', 0, 4);\n  var webpHeader = 'WEBP' === buffer.toString('ascii', 8, 12);\n  var vp8Header = 'VP8' === buffer.toString('ascii', 12, 15);\n  return riffHeader && webpHeader && vp8Header;\n}\n/* eslint-disable complexity */\n\n\nfunction calculate(buffer) {\n  var chunkHeader = buffer.toString('ascii', 12, 16);\n  buffer = buffer.slice(20, 30); // Extended webp stream signature\n\n  if (chunkHeader === 'VP8X') {\n    var extendedHeader = buffer[0];\n    var validStart = (extendedHeader & 0xc0) === 0;\n    var validEnd = (extendedHeader & 0x01) === 0;\n\n    if (validStart && validEnd) {\n      return calculateExtended(buffer);\n    } else {\n      return false;\n    }\n  } // Lossless webp stream signature\n\n\n  if (chunkHeader === 'VP8 ' && buffer[0] !== 0x2f) {\n    return calculateLossy(buffer);\n  } // Lossy webp stream signature\n\n\n  var signature = buffer.toString('hex', 3, 6);\n\n  if (chunkHeader === 'VP8L' && signature !== '9d012a') {\n    return calculateLossless(buffer);\n  }\n\n  return false;\n}\n/* eslint-enable complexity */\n\n\nfunction calculateExtended(buffer) {\n  return {\n    'width': 1 + buffer.readUIntLE(4, 3),\n    'height': 1 + buffer.readUIntLE(7, 3)\n  };\n}\n\nfunction calculateLossless(buffer) {\n  return {\n    'width': 1 + ((buffer[2] & 0x3F) << 8 | buffer[1]),\n    'height': 1 + ((buffer[4] & 0xF) << 10 | buffer[3] << 2 | (buffer[2] & 0xC0) >> 6)\n  };\n}\n\nfunction calculateLossy(buffer) {\n  // `& 0x3fff` returns the last 14 bits\n  // TO-DO: include webp scaling in the calculations\n  return {\n    'width': buffer.readInt16LE(6) & 0x3fff,\n    'height': buffer.readInt16LE(8) & 0x3fff\n  };\n}\n\nmodule.exports = {\n  'detect': isWebP,\n  'calculate': calculate\n};","map":{"version":3,"sources":["/Users/caseyrudick/Documents/landsharkrefactored-copy/client/node_modules/image-size/lib/types/webp.js"],"names":["isWebP","buffer","riffHeader","toString","webpHeader","vp8Header","calculate","chunkHeader","slice","extendedHeader","validStart","validEnd","calculateExtended","calculateLossy","signature","calculateLossless","readUIntLE","readInt16LE","module","exports"],"mappings":"AAAA,a,CAEA;;AAEA,SAASA,MAAT,CAAiBC,MAAjB,EAAyB;AACvB,MAAIC,UAAU,GAAG,WAAWD,MAAM,CAACE,QAAP,CAAgB,OAAhB,EAAyB,CAAzB,EAA4B,CAA5B,CAA5B;AACA,MAAIC,UAAU,GAAG,WAAWH,MAAM,CAACE,QAAP,CAAgB,OAAhB,EAAyB,CAAzB,EAA4B,EAA5B,CAA5B;AACA,MAAIE,SAAS,GAAI,UAAWJ,MAAM,CAACE,QAAP,CAAgB,OAAhB,EAAyB,EAAzB,EAA6B,EAA7B,CAA5B;AACA,SAAQD,UAAU,IAAIE,UAAd,IAA4BC,SAApC;AACD;AAED;;;AACA,SAASC,SAAT,CAAoBL,MAApB,EAA4B;AAC1B,MAAIM,WAAW,GAAGN,MAAM,CAACE,QAAP,CAAgB,OAAhB,EAAyB,EAAzB,EAA6B,EAA7B,CAAlB;AACAF,EAAAA,MAAM,GAAGA,MAAM,CAACO,KAAP,CAAa,EAAb,EAAiB,EAAjB,CAAT,CAF0B,CAI1B;;AACA,MAAID,WAAW,KAAK,MAApB,EAA4B;AAC1B,QAAIE,cAAc,GAAGR,MAAM,CAAC,CAAD,CAA3B;AACA,QAAIS,UAAU,GAAG,CAACD,cAAc,GAAG,IAAlB,MAA4B,CAA7C;AACA,QAAIE,QAAQ,GAAG,CAACF,cAAc,GAAG,IAAlB,MAA4B,CAA3C;;AACA,QAAIC,UAAU,IAAIC,QAAlB,EAA4B;AAC1B,aAAOC,iBAAiB,CAACX,MAAD,CAAxB;AACD,KAFD,MAEO;AACL,aAAO,KAAP;AACD;AACF,GAdyB,CAgB1B;;;AACA,MAAIM,WAAW,KAAK,MAAhB,IAA0BN,MAAM,CAAC,CAAD,CAAN,KAAc,IAA5C,EAAkD;AAChD,WAAOY,cAAc,CAACZ,MAAD,CAArB;AACD,GAnByB,CAqB1B;;;AACA,MAAIa,SAAS,GAAGb,MAAM,CAACE,QAAP,CAAgB,KAAhB,EAAuB,CAAvB,EAA0B,CAA1B,CAAhB;;AACA,MAAII,WAAW,KAAK,MAAhB,IAA0BO,SAAS,KAAK,QAA5C,EAAsD;AACpD,WAAOC,iBAAiB,CAACd,MAAD,CAAxB;AACD;;AAED,SAAO,KAAP;AACD;AACD;;;AAEA,SAASW,iBAAT,CAA4BX,MAA5B,EAAoC;AAClC,SAAO;AACL,aAAS,IAAIA,MAAM,CAACe,UAAP,CAAkB,CAAlB,EAAqB,CAArB,CADR;AAEL,cAAU,IAAIf,MAAM,CAACe,UAAP,CAAkB,CAAlB,EAAqB,CAArB;AAFT,GAAP;AAID;;AAED,SAASD,iBAAT,CAA4Bd,MAA5B,EAAoC;AAClC,SAAO;AACL,aAAS,KAAM,CAACA,MAAM,CAAC,CAAD,CAAN,GAAY,IAAb,KAAsB,CAAvB,GAA4BA,MAAM,CAAC,CAAD,CAAvC,CADJ;AAEL,cAAU,KAAM,CAACA,MAAM,CAAC,CAAD,CAAN,GAAY,GAAb,KAAqB,EAAtB,GAA6BA,MAAM,CAAC,CAAD,CAAN,IAAa,CAA1C,GACA,CAACA,MAAM,CAAC,CAAD,CAAN,GAAY,IAAb,KAAsB,CAD3B;AAFL,GAAP;AAKD;;AAED,SAASY,cAAT,CAAyBZ,MAAzB,EAAiC;AAC/B;AACA;AACA,SAAO;AACL,aAASA,MAAM,CAACgB,WAAP,CAAmB,CAAnB,IAAwB,MAD5B;AAEL,cAAUhB,MAAM,CAACgB,WAAP,CAAmB,CAAnB,IAAwB;AAF7B,GAAP;AAID;;AAEDC,MAAM,CAACC,OAAP,GAAiB;AACf,YAAUnB,MADK;AAEf,eAAaM;AAFE,CAAjB","sourcesContent":["'use strict';\n\n// based on https://developers.google.com/speed/webp/docs/riff_container\n\nfunction isWebP (buffer) {\n  var riffHeader = 'RIFF' === buffer.toString('ascii', 0, 4);\n  var webpHeader = 'WEBP' === buffer.toString('ascii', 8, 12);\n  var vp8Header  = 'VP8'  === buffer.toString('ascii', 12, 15);\n  return (riffHeader && webpHeader && vp8Header);\n}\n\n/* eslint-disable complexity */\nfunction calculate (buffer) {\n  var chunkHeader = buffer.toString('ascii', 12, 16);\n  buffer = buffer.slice(20, 30);\n\n  // Extended webp stream signature\n  if (chunkHeader === 'VP8X') {\n    var extendedHeader = buffer[0];\n    var validStart = (extendedHeader & 0xc0) === 0;\n    var validEnd = (extendedHeader & 0x01) === 0;\n    if (validStart && validEnd) {\n      return calculateExtended(buffer);\n    } else {\n      return false;\n    }\n  }\n\n  // Lossless webp stream signature\n  if (chunkHeader === 'VP8 ' && buffer[0] !== 0x2f) {\n    return calculateLossy(buffer);\n  }\n\n  // Lossy webp stream signature\n  var signature = buffer.toString('hex', 3, 6);\n  if (chunkHeader === 'VP8L' && signature !== '9d012a') {\n    return calculateLossless(buffer);\n  }\n\n  return false;\n}\n/* eslint-enable complexity */\n\nfunction calculateExtended (buffer) {\n  return {\n    'width': 1 + buffer.readUIntLE(4, 3),\n    'height': 1 + buffer.readUIntLE(7, 3)\n  };\n}\n\nfunction calculateLossless (buffer) {\n  return {\n    'width': 1 + (((buffer[2] & 0x3F) << 8) | buffer[1]),\n    'height': 1 + (((buffer[4] & 0xF) << 10) | (buffer[3] << 2) |\n                  ((buffer[2] & 0xC0) >> 6))\n  };\n}\n\nfunction calculateLossy (buffer) {\n  // `& 0x3fff` returns the last 14 bits\n  // TO-DO: include webp scaling in the calculations\n  return {\n    'width': buffer.readInt16LE(6) & 0x3fff,\n    'height': buffer.readInt16LE(8) & 0x3fff\n  };\n}\n\nmodule.exports = {\n  'detect': isWebP,\n  'calculate': calculate\n};\n"]},"metadata":{},"sourceType":"script"}