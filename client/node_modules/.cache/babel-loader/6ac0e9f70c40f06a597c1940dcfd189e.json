{"ast":null,"code":"/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar d3 = require('d3');\n\nvar rgba = require('color-rgba');\n\nvar Axes = require('../../plots/cartesian/axes');\n\nvar Lib = require('../../lib');\n\nvar strRotate = Lib.strRotate;\nvar strTranslate = Lib.strTranslate;\n\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar Drawing = require('../../components/drawing');\n\nvar Colorscale = require('../../components/colorscale');\n\nvar gup = require('../../lib/gup');\n\nvar keyFun = gup.keyFun;\nvar repeat = gup.repeat;\nvar unwrap = gup.unwrap;\n\nvar helpers = require('./helpers');\n\nvar c = require('./constants');\n\nvar brush = require('./axisbrush');\n\nvar lineLayerMaker = require('./lines');\n\nfunction findExtreme(fn, values, len) {\n  return Lib.aggNums(fn, null, values, len);\n}\n\nfunction findExtremes(values, len) {\n  return fixExtremes(findExtreme(Math.min, values, len), findExtreme(Math.max, values, len));\n}\n\nfunction dimensionExtent(dimension) {\n  var range = dimension.range;\n  return range ? fixExtremes(range[0], range[1]) : findExtremes(dimension.values, dimension._length);\n}\n\nfunction fixExtremes(lo, hi) {\n  if (isNaN(lo) || !isFinite(lo)) {\n    lo = 0;\n  }\n\n  if (isNaN(hi) || !isFinite(hi)) {\n    hi = 0;\n  } // avoid a degenerate (zero-width) domain\n\n\n  if (lo === hi) {\n    if (lo === 0) {\n      // no use to multiplying zero, so add/subtract in this case\n      lo -= 1;\n      hi += 1;\n    } else {\n      // this keeps the range in the order of magnitude of the data\n      lo *= 0.9;\n      hi *= 1.1;\n    }\n  }\n\n  return [lo, hi];\n}\n\nfunction toText(formatter, texts) {\n  if (texts) {\n    return function (v, i) {\n      var text = texts[i];\n      if (text === null || text === undefined) return formatter(v);\n      return text;\n    };\n  }\n\n  return formatter;\n}\n\nfunction domainScale(height, padding, dimension, tickvals, ticktext) {\n  var extent = dimensionExtent(dimension);\n\n  if (tickvals) {\n    return d3.scale.ordinal().domain(tickvals.map(toText(d3.format(dimension.tickformat), ticktext))).range(tickvals.map(function (d) {\n      var unitVal = (d - extent[0]) / (extent[1] - extent[0]);\n      return height - padding + unitVal * (2 * padding - height);\n    }));\n  }\n\n  return d3.scale.linear().domain(extent).range([height - padding, padding]);\n}\n\nfunction unitToPaddedPx(height, padding) {\n  return d3.scale.linear().range([padding, height - padding]);\n}\n\nfunction domainToPaddedUnitScale(dimension, padFraction) {\n  return d3.scale.linear().domain(dimensionExtent(dimension)).range([padFraction, 1 - padFraction]);\n}\n\nfunction ordinalScale(dimension) {\n  if (!dimension.tickvals) return;\n  var extent = dimensionExtent(dimension);\n  return d3.scale.ordinal().domain(dimension.tickvals).range(dimension.tickvals.map(function (d) {\n    return (d - extent[0]) / (extent[1] - extent[0]);\n  }));\n}\n\nfunction unitToColorScale(cscale) {\n  var colorStops = cscale.map(function (d) {\n    return d[0];\n  });\n  var colorTuples = cscale.map(function (d) {\n    var RGBA = rgba(d[1]);\n    return d3.rgb('rgb(' + RGBA[0] + ',' + RGBA[1] + ',' + RGBA[2] + ')');\n  });\n\n  var prop = function (n) {\n    return function (o) {\n      return o[n];\n    };\n  }; // We can't use d3 color interpolation as we may have non-uniform color palette raster\n  // (various color stop distances).\n\n\n  var polylinearUnitScales = 'rgb'.split('').map(function (key) {\n    return d3.scale.linear().clamp(true).domain(colorStops).range(colorTuples.map(prop(key)));\n  });\n  return function (d) {\n    return polylinearUnitScales.map(function (s) {\n      return s(d);\n    });\n  };\n}\n\nfunction someFiltersActive(view) {\n  return view.dimensions.some(function (p) {\n    return p.brush.filterSpecified;\n  });\n}\n\nfunction model(layout, d, i) {\n  var cd0 = unwrap(d);\n  var trace = cd0.trace;\n  var lineColor = helpers.convertTypedArray(cd0.lineColor);\n  var line = trace.line;\n  var deselectedLines = {\n    color: rgba(c.deselectedLineColor)\n  };\n  var cOpts = Colorscale.extractOpts(line);\n  var cscale = cOpts.reversescale ? Colorscale.flipScale(cd0.cscale) : cd0.cscale;\n  var domain = trace.domain;\n  var dimensions = trace.dimensions;\n  var width = layout.width;\n  var labelAngle = trace.labelangle;\n  var labelSide = trace.labelside;\n  var labelFont = trace.labelfont;\n  var tickFont = trace.tickfont;\n  var rangeFont = trace.rangefont;\n  var lines = Lib.extendDeepNoArrays({}, line, {\n    color: lineColor.map(d3.scale.linear().domain(dimensionExtent({\n      values: lineColor,\n      range: [cOpts.min, cOpts.max],\n      _length: trace._length\n    }))),\n    blockLineCount: c.blockLineCount,\n    canvasOverdrag: c.overdrag * c.canvasPixelRatio\n  });\n  var groupWidth = Math.floor(width * (domain.x[1] - domain.x[0]));\n  var groupHeight = Math.floor(layout.height * (domain.y[1] - domain.y[0]));\n  var pad = layout.margin || {\n    l: 80,\n    r: 80,\n    t: 100,\n    b: 80\n  };\n  var rowContentWidth = groupWidth;\n  var rowHeight = groupHeight;\n  return {\n    key: i,\n    colCount: dimensions.filter(helpers.isVisible).length,\n    dimensions: dimensions,\n    tickDistance: c.tickDistance,\n    unitToColor: unitToColorScale(cscale),\n    lines: lines,\n    deselectedLines: deselectedLines,\n    labelAngle: labelAngle,\n    labelSide: labelSide,\n    labelFont: labelFont,\n    tickFont: tickFont,\n    rangeFont: rangeFont,\n    layoutWidth: width,\n    layoutHeight: layout.height,\n    domain: domain,\n    translateX: domain.x[0] * width,\n    translateY: layout.height - domain.y[1] * layout.height,\n    pad: pad,\n    canvasWidth: rowContentWidth * c.canvasPixelRatio + 2 * lines.canvasOverdrag,\n    canvasHeight: rowHeight * c.canvasPixelRatio,\n    width: rowContentWidth,\n    height: rowHeight,\n    canvasPixelRatio: c.canvasPixelRatio\n  };\n}\n\nfunction viewModel(state, callbacks, model) {\n  var width = model.width;\n  var height = model.height;\n  var dimensions = model.dimensions;\n  var canvasPixelRatio = model.canvasPixelRatio;\n\n  var xScale = function (d) {\n    return width * d / Math.max(1, model.colCount - 1);\n  };\n\n  var unitPad = c.verticalPadding / height;\n\n  var _unitToPaddedPx = unitToPaddedPx(height, c.verticalPadding);\n\n  var vm = {\n    key: model.key,\n    xScale: xScale,\n    model: model,\n    inBrushDrag: false // consider factoring it out and putting it in a centralized global-ish gesture state object\n\n  };\n  var uniqueKeys = {};\n  vm.dimensions = dimensions.filter(helpers.isVisible).map(function (dimension, i) {\n    var domainToPaddedUnit = domainToPaddedUnitScale(dimension, unitPad);\n    var foundKey = uniqueKeys[dimension.label];\n    uniqueKeys[dimension.label] = (foundKey || 0) + 1;\n    var key = dimension.label + (foundKey ? '__' + foundKey : '');\n    var specifiedConstraint = dimension.constraintrange;\n    var filterRangeSpecified = specifiedConstraint && specifiedConstraint.length;\n\n    if (filterRangeSpecified && !Array.isArray(specifiedConstraint[0])) {\n      specifiedConstraint = [specifiedConstraint];\n    }\n\n    var filterRange = filterRangeSpecified ? specifiedConstraint.map(function (d) {\n      return d.map(domainToPaddedUnit);\n    }) : [[-Infinity, Infinity]];\n\n    var brushMove = function () {\n      var p = vm;\n      p.focusLayer && p.focusLayer.render(p.panels, true);\n      var filtersActive = someFiltersActive(p);\n\n      if (!state.contextShown() && filtersActive) {\n        p.contextLayer && p.contextLayer.render(p.panels, true);\n        state.contextShown(true);\n      } else if (state.contextShown() && !filtersActive) {\n        p.contextLayer && p.contextLayer.render(p.panels, true, true);\n        state.contextShown(false);\n      }\n    };\n\n    var truncatedValues = dimension.values;\n\n    if (truncatedValues.length > dimension._length) {\n      truncatedValues = truncatedValues.slice(0, dimension._length);\n    }\n\n    var tickvals = dimension.tickvals;\n    var ticktext;\n\n    function makeTickItem(v, i) {\n      return {\n        val: v,\n        text: ticktext[i]\n      };\n    }\n\n    function sortTickItem(a, b) {\n      return a.val - b.val;\n    }\n\n    if (Array.isArray(tickvals) && tickvals.length) {\n      ticktext = dimension.ticktext; // ensure ticktext and tickvals have same length\n\n      if (!Array.isArray(ticktext) || !ticktext.length) {\n        ticktext = tickvals.map(d3.format(dimension.tickformat));\n      } else if (ticktext.length > tickvals.length) {\n        ticktext = ticktext.slice(0, tickvals.length);\n      } else if (tickvals.length > ticktext.length) {\n        tickvals = tickvals.slice(0, ticktext.length);\n      } // check if we need to sort tickvals/ticktext\n\n\n      for (var j = 1; j < tickvals.length; j++) {\n        if (tickvals[j] < tickvals[j - 1]) {\n          var tickItems = tickvals.map(makeTickItem).sort(sortTickItem);\n\n          for (var k = 0; k < tickvals.length; k++) {\n            tickvals[k] = tickItems[k].val;\n            ticktext[k] = tickItems[k].text;\n          }\n\n          break;\n        }\n      }\n    } else tickvals = undefined;\n\n    truncatedValues = helpers.convertTypedArray(truncatedValues);\n    return {\n      key: key,\n      label: dimension.label,\n      tickFormat: dimension.tickformat,\n      tickvals: tickvals,\n      ticktext: ticktext,\n      ordinal: helpers.isOrdinal(dimension),\n      multiselect: dimension.multiselect,\n      xIndex: i,\n      crossfilterDimensionIndex: i,\n      visibleIndex: dimension._index,\n      height: height,\n      values: truncatedValues,\n      paddedUnitValues: truncatedValues.map(domainToPaddedUnit),\n      unitTickvals: tickvals && tickvals.map(domainToPaddedUnit),\n      xScale: xScale,\n      x: xScale(i),\n      canvasX: xScale(i) * canvasPixelRatio,\n      unitToPaddedPx: _unitToPaddedPx,\n      domainScale: domainScale(height, c.verticalPadding, dimension, tickvals, ticktext),\n      ordinalScale: ordinalScale(dimension),\n      parent: vm,\n      model: model,\n      brush: brush.makeBrush(state, filterRangeSpecified, filterRange, function () {\n        state.linePickActive(false);\n      }, brushMove, function (f) {\n        vm.focusLayer.render(vm.panels, true);\n        vm.pickLayer && vm.pickLayer.render(vm.panels, true);\n        state.linePickActive(true);\n\n        if (callbacks && callbacks.filterChanged) {\n          var invScale = domainToPaddedUnit.invert; // update gd.data as if a Plotly.restyle were fired\n\n          var newRanges = f.map(function (r) {\n            return r.map(invScale).sort(Lib.sorterAsc);\n          }).sort(function (a, b) {\n            return a[0] - b[0];\n          });\n          callbacks.filterChanged(vm.key, dimension._index, newRanges);\n        }\n      })\n    };\n  });\n  return vm;\n}\n\nfunction styleExtentTexts(selection) {\n  selection.classed(c.cn.axisExtentText, true).attr('text-anchor', 'middle').style('cursor', 'default');\n}\n\nfunction parcoordsInteractionState() {\n  var linePickActive = true;\n  var contextShown = false;\n  return {\n    linePickActive: function (val) {\n      return arguments.length ? linePickActive = !!val : linePickActive;\n    },\n    contextShown: function (val) {\n      return arguments.length ? contextShown = !!val : contextShown;\n    }\n  };\n}\n\nfunction calcTilt(angle, position) {\n  var dir = position === 'top' ? 1 : -1;\n  var radians = angle * Math.PI / 180;\n  var dx = Math.sin(radians);\n  var dy = Math.cos(radians);\n  return {\n    dir: dir,\n    dx: dx,\n    dy: dy,\n    degrees: angle\n  };\n}\n\nfunction updatePanelLayout(yAxis, vm) {\n  var panels = vm.panels || (vm.panels = []);\n  var data = yAxis.data();\n\n  for (var i = 0; i < data.length - 1; i++) {\n    var p = panels[i] || (panels[i] = {});\n    var dim0 = data[i];\n    var dim1 = data[i + 1];\n    p.dim0 = dim0;\n    p.dim1 = dim1;\n    p.canvasX = dim0.canvasX;\n    p.panelSizeX = dim1.canvasX - dim0.canvasX;\n    p.panelSizeY = vm.model.canvasHeight;\n    p.y = 0;\n    p.canvasY = 0;\n  }\n}\n\nfunction calcAllTicks(cd) {\n  for (var i = 0; i < cd.length; i++) {\n    for (var j = 0; j < cd[i].length; j++) {\n      var trace = cd[i][j].trace;\n      var dimensions = trace.dimensions;\n\n      for (var k = 0; k < dimensions.length; k++) {\n        var values = dimensions[k].values;\n        var dim = dimensions[k]._ax;\n\n        if (dim) {\n          if (!dim.range) {\n            dim.range = findExtremes(values, trace._length);\n          } else {\n            dim.range = fixExtremes(dim.range[0], dim.range[1]);\n          }\n\n          if (!dim.dtick) {\n            dim.dtick = 0.01 * (Math.abs(dim.range[1] - dim.range[0]) || 1);\n          }\n\n          dim.tickformat = dimensions[k].tickformat;\n          Axes.calcTicks(dim);\n          dim.cleanRange();\n        }\n      }\n    }\n  }\n}\n\nfunction linearFormat(dim, v) {\n  return Axes.tickText(dim._ax, v, false).text;\n}\n\nfunction extremeText(d, isTop) {\n  if (d.ordinal) return '';\n  var domain = d.domainScale.domain();\n  var v = domain[isTop ? domain.length - 1 : 0];\n  return linearFormat(d.model.dimensions[d.visibleIndex], v);\n}\n\nmodule.exports = function parcoords(gd, cdModule, layout, callbacks) {\n  var fullLayout = gd._fullLayout;\n  var svg = fullLayout._toppaper;\n  var glContainer = fullLayout._glcontainer;\n  calcAllTicks(cdModule);\n  var state = parcoordsInteractionState();\n  var vm = cdModule.filter(function (d) {\n    return unwrap(d).trace.visible;\n  }).map(model.bind(0, layout)).map(viewModel.bind(0, state, callbacks));\n  glContainer.each(function (d, i) {\n    return Lib.extendFlat(d, vm[i]);\n  });\n  var glLayers = glContainer.selectAll('.gl-canvas').each(function (d) {\n    // FIXME: figure out how to handle multiple instances\n    d.viewModel = vm[0];\n    d.model = d.viewModel ? d.viewModel.model : null;\n  });\n  var lastHovered = null;\n  var pickLayer = glLayers.filter(function (d) {\n    return d.pick;\n  }); // emit hover / unhover event\n\n  pickLayer.style('pointer-events', 'auto').on('mousemove', function (d) {\n    if (state.linePickActive() && d.lineLayer && callbacks && callbacks.hover) {\n      var event = d3.event;\n      var cw = this.width;\n      var ch = this.height;\n      var pointer = d3.mouse(this);\n      var x = pointer[0];\n      var y = pointer[1];\n\n      if (x < 0 || y < 0 || x >= cw || y >= ch) {\n        return;\n      }\n\n      var pixel = d.lineLayer.readPixel(x, ch - 1 - y);\n      var found = pixel[3] !== 0; // inverse of the calcPickColor in `lines.js`; detailed comment there\n\n      var curveNumber = found ? pixel[2] + 256 * (pixel[1] + 256 * pixel[0]) : null;\n      var eventData = {\n        x: x,\n        y: y,\n        clientX: event.clientX,\n        clientY: event.clientY,\n        dataIndex: d.model.key,\n        curveNumber: curveNumber\n      };\n\n      if (curveNumber !== lastHovered) {\n        // don't unnecessarily repeat the same hit (or miss)\n        if (found) {\n          callbacks.hover(eventData);\n        } else if (callbacks.unhover) {\n          callbacks.unhover(eventData);\n        }\n\n        lastHovered = curveNumber;\n      }\n    }\n  });\n  glLayers.style('opacity', function (d) {\n    return d.pick ? 0 : 1;\n  });\n  svg.style('background', 'rgba(255, 255, 255, 0)');\n  var controlOverlay = svg.selectAll('.' + c.cn.parcoords).data(vm, keyFun);\n  controlOverlay.exit().remove();\n  controlOverlay.enter().append('g').classed(c.cn.parcoords, true).style('shape-rendering', 'crispEdges').style('pointer-events', 'none');\n  controlOverlay.attr('transform', function (d) {\n    return strTranslate(d.model.translateX, d.model.translateY);\n  });\n  var parcoordsControlView = controlOverlay.selectAll('.' + c.cn.parcoordsControlView).data(repeat, keyFun);\n  parcoordsControlView.enter().append('g').classed(c.cn.parcoordsControlView, true);\n  parcoordsControlView.attr('transform', function (d) {\n    return strTranslate(d.model.pad.l, d.model.pad.t);\n  });\n  var yAxis = parcoordsControlView.selectAll('.' + c.cn.yAxis).data(function (p) {\n    return p.dimensions;\n  }, keyFun);\n  yAxis.enter().append('g').classed(c.cn.yAxis, true);\n  parcoordsControlView.each(function (p) {\n    updatePanelLayout(yAxis, p);\n  });\n  glLayers.each(function (d) {\n    if (d.viewModel) {\n      if (!d.lineLayer || callbacks) {\n        // recreate in case of having callbacks e.g. restyle. Should we test for callback to be a restyle?\n        d.lineLayer = lineLayerMaker(this, d);\n      } else d.lineLayer.update(d);\n\n      if (d.key || d.key === 0) d.viewModel[d.key] = d.lineLayer;\n      var setChanged = !d.context || // don't update background\n      callbacks; // unless there is a callback on the context layer. Should we test the callback?\n\n      d.lineLayer.render(d.viewModel.panels, setChanged);\n    }\n  });\n  yAxis.attr('transform', function (d) {\n    return strTranslate(d.xScale(d.xIndex), 0);\n  }); // drag column for reordering columns\n\n  yAxis.call(d3.behavior.drag().origin(function (d) {\n    return d;\n  }).on('drag', function (d) {\n    var p = d.parent;\n    state.linePickActive(false);\n    d.x = Math.max(-c.overdrag, Math.min(d.model.width + c.overdrag, d3.event.x));\n    d.canvasX = d.x * d.model.canvasPixelRatio;\n    yAxis.sort(function (a, b) {\n      return a.x - b.x;\n    }).each(function (e, i) {\n      e.xIndex = i;\n      e.x = d === e ? e.x : e.xScale(e.xIndex);\n      e.canvasX = e.x * e.model.canvasPixelRatio;\n    });\n    updatePanelLayout(yAxis, p);\n    yAxis.filter(function (e) {\n      return Math.abs(d.xIndex - e.xIndex) !== 0;\n    }).attr('transform', function (d) {\n      return strTranslate(d.xScale(d.xIndex), 0);\n    });\n    d3.select(this).attr('transform', strTranslate(d.x, 0));\n    yAxis.each(function (e, i0, i1) {\n      if (i1 === d.parent.key) p.dimensions[i0] = e;\n    });\n    p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n    p.focusLayer.render && p.focusLayer.render(p.panels);\n  }).on('dragend', function (d) {\n    var p = d.parent;\n    d.x = d.xScale(d.xIndex);\n    d.canvasX = d.x * d.model.canvasPixelRatio;\n    updatePanelLayout(yAxis, p);\n    d3.select(this).attr('transform', function (d) {\n      return strTranslate(d.x, 0);\n    });\n    p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n    p.focusLayer && p.focusLayer.render(p.panels);\n    p.pickLayer && p.pickLayer.render(p.panels, true);\n    state.linePickActive(true);\n\n    if (callbacks && callbacks.axesMoved) {\n      callbacks.axesMoved(p.key, p.dimensions.map(function (e) {\n        return e.crossfilterDimensionIndex;\n      }));\n    }\n  }));\n  yAxis.exit().remove();\n  var axisOverlays = yAxis.selectAll('.' + c.cn.axisOverlays).data(repeat, keyFun);\n  axisOverlays.enter().append('g').classed(c.cn.axisOverlays, true);\n  axisOverlays.selectAll('.' + c.cn.axis).remove();\n  var axis = axisOverlays.selectAll('.' + c.cn.axis).data(repeat, keyFun);\n  axis.enter().append('g').classed(c.cn.axis, true);\n  axis.each(function (d) {\n    var wantedTickCount = d.model.height / d.model.tickDistance;\n    var scale = d.domainScale;\n    var sdom = scale.domain();\n    d3.select(this).call(d3.svg.axis().orient('left').tickSize(4).outerTickSize(2).ticks(wantedTickCount, d.tickFormat) // works for continuous scales only...\n    .tickValues(d.ordinal ? // and this works for ordinal scales\n    sdom : null).tickFormat(function (v) {\n      return helpers.isOrdinal(d) ? v : linearFormat(d.model.dimensions[d.visibleIndex], v);\n    }).scale(scale));\n    Drawing.font(axis.selectAll('text'), d.model.tickFont);\n  });\n  axis.selectAll('.domain, .tick>line').attr('fill', 'none').attr('stroke', 'black').attr('stroke-opacity', 0.25).attr('stroke-width', '1px');\n  axis.selectAll('text').style('text-shadow', '1px 1px 1px #fff, -1px -1px 1px #fff, 1px -1px 1px #fff, -1px 1px 1px #fff').style('cursor', 'default');\n  var axisHeading = axisOverlays.selectAll('.' + c.cn.axisHeading).data(repeat, keyFun);\n  axisHeading.enter().append('g').classed(c.cn.axisHeading, true);\n  var axisTitle = axisHeading.selectAll('.' + c.cn.axisTitle).data(repeat, keyFun);\n  axisTitle.enter().append('text').classed(c.cn.axisTitle, true).attr('text-anchor', 'middle').style('cursor', 'ew-resize').style('pointer-events', 'auto');\n  axisTitle.text(function (d) {\n    return d.label;\n  }).each(function (d) {\n    var e = d3.select(this);\n    Drawing.font(e, d.model.labelFont);\n    svgTextUtils.convertToTspans(e, gd);\n  }).attr('transform', function (d) {\n    var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n    var r = c.axisTitleOffset;\n    return (tilt.dir > 0 ? '' : strTranslate(0, 2 * r + d.model.height)) + strRotate(tilt.degrees) + strTranslate(-r * tilt.dx, -r * tilt.dy);\n  }).attr('text-anchor', function (d) {\n    var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n    var adx = Math.abs(tilt.dx);\n    var ady = Math.abs(tilt.dy);\n\n    if (2 * adx > ady) {\n      return tilt.dir * tilt.dx < 0 ? 'start' : 'end';\n    } else {\n      return 'middle';\n    }\n  });\n  var axisExtent = axisOverlays.selectAll('.' + c.cn.axisExtent).data(repeat, keyFun);\n  axisExtent.enter().append('g').classed(c.cn.axisExtent, true);\n  var axisExtentTop = axisExtent.selectAll('.' + c.cn.axisExtentTop).data(repeat, keyFun);\n  axisExtentTop.enter().append('g').classed(c.cn.axisExtentTop, true);\n  axisExtentTop.attr('transform', strTranslate(0, -c.axisExtentOffset));\n  var axisExtentTopText = axisExtentTop.selectAll('.' + c.cn.axisExtentTopText).data(repeat, keyFun);\n  axisExtentTopText.enter().append('text').classed(c.cn.axisExtentTopText, true).call(styleExtentTexts);\n  axisExtentTopText.text(function (d) {\n    return extremeText(d, true);\n  }).each(function (d) {\n    Drawing.font(d3.select(this), d.model.rangeFont);\n  });\n  var axisExtentBottom = axisExtent.selectAll('.' + c.cn.axisExtentBottom).data(repeat, keyFun);\n  axisExtentBottom.enter().append('g').classed(c.cn.axisExtentBottom, true);\n  axisExtentBottom.attr('transform', function (d) {\n    return strTranslate(0, d.model.height + c.axisExtentOffset);\n  });\n  var axisExtentBottomText = axisExtentBottom.selectAll('.' + c.cn.axisExtentBottomText).data(repeat, keyFun);\n  axisExtentBottomText.enter().append('text').classed(c.cn.axisExtentBottomText, true).attr('dy', '0.75em').call(styleExtentTexts);\n  axisExtentBottomText.text(function (d) {\n    return extremeText(d, false);\n  }).each(function (d) {\n    Drawing.font(d3.select(this), d.model.rangeFont);\n  });\n  brush.ensureAxisBrush(axisOverlays);\n};","map":{"version":3,"sources":["/Users/caseyrudick/Documents/landsharkrefactored-copy/client/node_modules/plotly.js/src/traces/parcoords/parcoords.js"],"names":["d3","require","rgba","Axes","Lib","strRotate","strTranslate","svgTextUtils","Drawing","Colorscale","gup","keyFun","repeat","unwrap","helpers","c","brush","lineLayerMaker","findExtreme","fn","values","len","aggNums","findExtremes","fixExtremes","Math","min","max","dimensionExtent","dimension","range","_length","lo","hi","isNaN","isFinite","toText","formatter","texts","v","i","text","undefined","domainScale","height","padding","tickvals","ticktext","extent","scale","ordinal","domain","map","format","tickformat","d","unitVal","linear","unitToPaddedPx","domainToPaddedUnitScale","padFraction","ordinalScale","unitToColorScale","cscale","colorStops","colorTuples","RGBA","rgb","prop","n","o","polylinearUnitScales","split","key","clamp","s","someFiltersActive","view","dimensions","some","p","filterSpecified","model","layout","cd0","trace","lineColor","convertTypedArray","line","deselectedLines","color","deselectedLineColor","cOpts","extractOpts","reversescale","flipScale","width","labelAngle","labelangle","labelSide","labelside","labelFont","labelfont","tickFont","tickfont","rangeFont","rangefont","lines","extendDeepNoArrays","blockLineCount","canvasOverdrag","overdrag","canvasPixelRatio","groupWidth","floor","x","groupHeight","y","pad","margin","l","r","t","b","rowContentWidth","rowHeight","colCount","filter","isVisible","length","tickDistance","unitToColor","layoutWidth","layoutHeight","translateX","translateY","canvasWidth","canvasHeight","viewModel","state","callbacks","xScale","unitPad","verticalPadding","_unitToPaddedPx","vm","inBrushDrag","uniqueKeys","domainToPaddedUnit","foundKey","label","specifiedConstraint","constraintrange","filterRangeSpecified","Array","isArray","filterRange","Infinity","brushMove","focusLayer","render","panels","filtersActive","contextShown","contextLayer","truncatedValues","slice","makeTickItem","val","sortTickItem","a","j","tickItems","sort","k","tickFormat","isOrdinal","multiselect","xIndex","crossfilterDimensionIndex","visibleIndex","_index","paddedUnitValues","unitTickvals","canvasX","parent","makeBrush","linePickActive","f","pickLayer","filterChanged","invScale","invert","newRanges","sorterAsc","styleExtentTexts","selection","classed","cn","axisExtentText","attr","style","parcoordsInteractionState","arguments","calcTilt","angle","position","dir","radians","PI","dx","sin","dy","cos","degrees","updatePanelLayout","yAxis","data","dim0","dim1","panelSizeX","panelSizeY","canvasY","calcAllTicks","cd","dim","_ax","dtick","abs","calcTicks","cleanRange","linearFormat","tickText","extremeText","isTop","module","exports","parcoords","gd","cdModule","fullLayout","_fullLayout","svg","_toppaper","glContainer","_glcontainer","visible","bind","each","extendFlat","glLayers","selectAll","lastHovered","pick","on","lineLayer","hover","event","cw","ch","pointer","mouse","pixel","readPixel","found","curveNumber","eventData","clientX","clientY","dataIndex","unhover","controlOverlay","exit","remove","enter","append","parcoordsControlView","update","setChanged","context","call","behavior","drag","origin","e","select","i0","i1","axesMoved","axisOverlays","axis","wantedTickCount","sdom","orient","tickSize","outerTickSize","ticks","tickValues","font","axisHeading","axisTitle","convertToTspans","tilt","axisTitleOffset","adx","ady","axisExtent","axisExtentTop","axisExtentOffset","axisExtentTopText","axisExtentBottom","axisExtentBottomText","ensureAxisBrush"],"mappings":"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","sourcesContent":["/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar d3 = require('d3');\nvar rgba = require('color-rgba');\n\nvar Axes = require('../../plots/cartesian/axes');\nvar Lib = require('../../lib');\nvar strRotate = Lib.strRotate;\nvar strTranslate = Lib.strTranslate;\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar Drawing = require('../../components/drawing');\nvar Colorscale = require('../../components/colorscale');\n\nvar gup = require('../../lib/gup');\nvar keyFun = gup.keyFun;\nvar repeat = gup.repeat;\nvar unwrap = gup.unwrap;\n\nvar helpers = require('./helpers');\nvar c = require('./constants');\nvar brush = require('./axisbrush');\nvar lineLayerMaker = require('./lines');\n\nfunction findExtreme(fn, values, len) {\n    return Lib.aggNums(fn, null, values, len);\n}\n\nfunction findExtremes(values, len) {\n    return fixExtremes(\n        findExtreme(Math.min, values, len),\n        findExtreme(Math.max, values, len)\n    );\n}\n\nfunction dimensionExtent(dimension) {\n    var range = dimension.range;\n    return range ?\n        fixExtremes(range[0], range[1]) :\n        findExtremes(dimension.values, dimension._length);\n}\n\nfunction fixExtremes(lo, hi) {\n    if(isNaN(lo) || !isFinite(lo)) {\n        lo = 0;\n    }\n\n    if(isNaN(hi) || !isFinite(hi)) {\n        hi = 0;\n    }\n\n    // avoid a degenerate (zero-width) domain\n    if(lo === hi) {\n        if(lo === 0) {\n            // no use to multiplying zero, so add/subtract in this case\n            lo -= 1;\n            hi += 1;\n        } else {\n            // this keeps the range in the order of magnitude of the data\n            lo *= 0.9;\n            hi *= 1.1;\n        }\n    }\n\n    return [lo, hi];\n}\n\nfunction toText(formatter, texts) {\n    if(texts) {\n        return function(v, i) {\n            var text = texts[i];\n            if(text === null || text === undefined) return formatter(v);\n            return text;\n        };\n    }\n    return formatter;\n}\n\nfunction domainScale(height, padding, dimension, tickvals, ticktext) {\n    var extent = dimensionExtent(dimension);\n    if(tickvals) {\n        return d3.scale.ordinal()\n            .domain(tickvals.map(toText(d3.format(dimension.tickformat), ticktext)))\n            .range(tickvals\n                .map(function(d) {\n                    var unitVal = (d - extent[0]) / (extent[1] - extent[0]);\n                    return (height - padding + unitVal * (2 * padding - height));\n                })\n            );\n    }\n    return d3.scale.linear()\n        .domain(extent)\n        .range([height - padding, padding]);\n}\n\nfunction unitToPaddedPx(height, padding) {\n    return d3.scale.linear().range([padding, height - padding]);\n}\n\nfunction domainToPaddedUnitScale(dimension, padFraction) {\n    return d3.scale.linear()\n        .domain(dimensionExtent(dimension))\n        .range([padFraction, 1 - padFraction]);\n}\n\nfunction ordinalScale(dimension) {\n    if(!dimension.tickvals) return;\n\n    var extent = dimensionExtent(dimension);\n    return d3.scale.ordinal()\n        .domain(dimension.tickvals)\n        .range(dimension.tickvals.map(function(d) {\n            return (d - extent[0]) / (extent[1] - extent[0]);\n        }));\n}\n\nfunction unitToColorScale(cscale) {\n    var colorStops = cscale.map(function(d) { return d[0]; });\n    var colorTuples = cscale.map(function(d) {\n        var RGBA = rgba(d[1]);\n        return d3.rgb('rgb(' + RGBA[0] + ',' + RGBA[1] + ',' + RGBA[2] + ')');\n    });\n    var prop = function(n) { return function(o) { return o[n]; }; };\n\n    // We can't use d3 color interpolation as we may have non-uniform color palette raster\n    // (various color stop distances).\n    var polylinearUnitScales = 'rgb'.split('').map(function(key) {\n        return d3.scale.linear()\n            .clamp(true)\n            .domain(colorStops)\n            .range(colorTuples.map(prop(key)));\n    });\n\n    return function(d) {\n        return polylinearUnitScales.map(function(s) {\n            return s(d);\n        });\n    };\n}\n\nfunction someFiltersActive(view) {\n    return view.dimensions.some(function(p) {\n        return p.brush.filterSpecified;\n    });\n}\n\nfunction model(layout, d, i) {\n    var cd0 = unwrap(d);\n    var trace = cd0.trace;\n    var lineColor = helpers.convertTypedArray(cd0.lineColor);\n    var line = trace.line;\n    var deselectedLines = {color: rgba(c.deselectedLineColor)};\n    var cOpts = Colorscale.extractOpts(line);\n    var cscale = cOpts.reversescale ? Colorscale.flipScale(cd0.cscale) : cd0.cscale;\n    var domain = trace.domain;\n    var dimensions = trace.dimensions;\n    var width = layout.width;\n    var labelAngle = trace.labelangle;\n    var labelSide = trace.labelside;\n    var labelFont = trace.labelfont;\n    var tickFont = trace.tickfont;\n    var rangeFont = trace.rangefont;\n\n    var lines = Lib.extendDeepNoArrays({}, line, {\n        color: lineColor.map(d3.scale.linear().domain(\n            dimensionExtent({\n                values: lineColor,\n                range: [cOpts.min, cOpts.max],\n                _length: trace._length\n            })\n        )),\n        blockLineCount: c.blockLineCount,\n        canvasOverdrag: c.overdrag * c.canvasPixelRatio\n    });\n\n    var groupWidth = Math.floor(width * (domain.x[1] - domain.x[0]));\n    var groupHeight = Math.floor(layout.height * (domain.y[1] - domain.y[0]));\n\n    var pad = layout.margin || {l: 80, r: 80, t: 100, b: 80};\n    var rowContentWidth = groupWidth;\n    var rowHeight = groupHeight;\n\n    return {\n        key: i,\n        colCount: dimensions.filter(helpers.isVisible).length,\n        dimensions: dimensions,\n        tickDistance: c.tickDistance,\n        unitToColor: unitToColorScale(cscale),\n        lines: lines,\n        deselectedLines: deselectedLines,\n        labelAngle: labelAngle,\n        labelSide: labelSide,\n        labelFont: labelFont,\n        tickFont: tickFont,\n        rangeFont: rangeFont,\n        layoutWidth: width,\n        layoutHeight: layout.height,\n        domain: domain,\n        translateX: domain.x[0] * width,\n        translateY: layout.height - domain.y[1] * layout.height,\n        pad: pad,\n        canvasWidth: rowContentWidth * c.canvasPixelRatio + 2 * lines.canvasOverdrag,\n        canvasHeight: rowHeight * c.canvasPixelRatio,\n        width: rowContentWidth,\n        height: rowHeight,\n        canvasPixelRatio: c.canvasPixelRatio\n    };\n}\n\nfunction viewModel(state, callbacks, model) {\n    var width = model.width;\n    var height = model.height;\n    var dimensions = model.dimensions;\n    var canvasPixelRatio = model.canvasPixelRatio;\n\n    var xScale = function(d) {return width * d / Math.max(1, model.colCount - 1);};\n\n    var unitPad = c.verticalPadding / height;\n    var _unitToPaddedPx = unitToPaddedPx(height, c.verticalPadding);\n\n    var vm = {\n        key: model.key,\n        xScale: xScale,\n        model: model,\n        inBrushDrag: false // consider factoring it out and putting it in a centralized global-ish gesture state object\n    };\n\n    var uniqueKeys = {};\n\n    vm.dimensions = dimensions.filter(helpers.isVisible).map(function(dimension, i) {\n        var domainToPaddedUnit = domainToPaddedUnitScale(dimension, unitPad);\n        var foundKey = uniqueKeys[dimension.label];\n        uniqueKeys[dimension.label] = (foundKey || 0) + 1;\n        var key = dimension.label + (foundKey ? '__' + foundKey : '');\n        var specifiedConstraint = dimension.constraintrange;\n        var filterRangeSpecified = specifiedConstraint && specifiedConstraint.length;\n        if(filterRangeSpecified && !Array.isArray(specifiedConstraint[0])) {\n            specifiedConstraint = [specifiedConstraint];\n        }\n        var filterRange = filterRangeSpecified ?\n            specifiedConstraint.map(function(d) { return d.map(domainToPaddedUnit); }) :\n            [[-Infinity, Infinity]];\n        var brushMove = function() {\n            var p = vm;\n            p.focusLayer && p.focusLayer.render(p.panels, true);\n            var filtersActive = someFiltersActive(p);\n            if(!state.contextShown() && filtersActive) {\n                p.contextLayer && p.contextLayer.render(p.panels, true);\n                state.contextShown(true);\n            } else if(state.contextShown() && !filtersActive) {\n                p.contextLayer && p.contextLayer.render(p.panels, true, true);\n                state.contextShown(false);\n            }\n        };\n\n        var truncatedValues = dimension.values;\n        if(truncatedValues.length > dimension._length) {\n            truncatedValues = truncatedValues.slice(0, dimension._length);\n        }\n\n        var tickvals = dimension.tickvals;\n        var ticktext;\n        function makeTickItem(v, i) { return {val: v, text: ticktext[i]}; }\n        function sortTickItem(a, b) { return a.val - b.val; }\n        if(Array.isArray(tickvals) && tickvals.length) {\n            ticktext = dimension.ticktext;\n\n            // ensure ticktext and tickvals have same length\n            if(!Array.isArray(ticktext) || !ticktext.length) {\n                ticktext = tickvals.map(d3.format(dimension.tickformat));\n            } else if(ticktext.length > tickvals.length) {\n                ticktext = ticktext.slice(0, tickvals.length);\n            } else if(tickvals.length > ticktext.length) {\n                tickvals = tickvals.slice(0, ticktext.length);\n            }\n\n            // check if we need to sort tickvals/ticktext\n            for(var j = 1; j < tickvals.length; j++) {\n                if(tickvals[j] < tickvals[j - 1]) {\n                    var tickItems = tickvals.map(makeTickItem).sort(sortTickItem);\n                    for(var k = 0; k < tickvals.length; k++) {\n                        tickvals[k] = tickItems[k].val;\n                        ticktext[k] = tickItems[k].text;\n                    }\n                    break;\n                }\n            }\n        } else tickvals = undefined;\n\n        truncatedValues = helpers.convertTypedArray(truncatedValues);\n\n        return {\n            key: key,\n            label: dimension.label,\n            tickFormat: dimension.tickformat,\n            tickvals: tickvals,\n            ticktext: ticktext,\n            ordinal: helpers.isOrdinal(dimension),\n            multiselect: dimension.multiselect,\n            xIndex: i,\n            crossfilterDimensionIndex: i,\n            visibleIndex: dimension._index,\n            height: height,\n            values: truncatedValues,\n            paddedUnitValues: truncatedValues.map(domainToPaddedUnit),\n            unitTickvals: tickvals && tickvals.map(domainToPaddedUnit),\n            xScale: xScale,\n            x: xScale(i),\n            canvasX: xScale(i) * canvasPixelRatio,\n            unitToPaddedPx: _unitToPaddedPx,\n            domainScale: domainScale(height, c.verticalPadding, dimension, tickvals, ticktext),\n            ordinalScale: ordinalScale(dimension),\n            parent: vm,\n            model: model,\n            brush: brush.makeBrush(\n                state,\n                filterRangeSpecified,\n                filterRange,\n                function() {\n                    state.linePickActive(false);\n                },\n                brushMove,\n                function(f) {\n                    vm.focusLayer.render(vm.panels, true);\n                    vm.pickLayer && vm.pickLayer.render(vm.panels, true);\n                    state.linePickActive(true);\n                    if(callbacks && callbacks.filterChanged) {\n                        var invScale = domainToPaddedUnit.invert;\n\n                        // update gd.data as if a Plotly.restyle were fired\n                        var newRanges = f.map(function(r) {\n                            return r.map(invScale).sort(Lib.sorterAsc);\n                        }).sort(function(a, b) { return a[0] - b[0]; });\n                        callbacks.filterChanged(vm.key, dimension._index, newRanges);\n                    }\n                }\n            )\n        };\n    });\n\n    return vm;\n}\n\nfunction styleExtentTexts(selection) {\n    selection\n        .classed(c.cn.axisExtentText, true)\n        .attr('text-anchor', 'middle')\n        .style('cursor', 'default');\n}\n\nfunction parcoordsInteractionState() {\n    var linePickActive = true;\n    var contextShown = false;\n    return {\n        linePickActive: function(val) {return arguments.length ? linePickActive = !!val : linePickActive;},\n        contextShown: function(val) {return arguments.length ? contextShown = !!val : contextShown;}\n    };\n}\n\nfunction calcTilt(angle, position) {\n    var dir = (position === 'top') ? 1 : -1;\n    var radians = angle * Math.PI / 180;\n    var dx = Math.sin(radians);\n    var dy = Math.cos(radians);\n    return {\n        dir: dir,\n        dx: dx,\n        dy: dy,\n        degrees: angle\n    };\n}\n\nfunction updatePanelLayout(yAxis, vm) {\n    var panels = vm.panels || (vm.panels = []);\n    var data = yAxis.data();\n    for(var i = 0; i < data.length - 1; i++) {\n        var p = panels[i] || (panels[i] = {});\n        var dim0 = data[i];\n        var dim1 = data[i + 1];\n        p.dim0 = dim0;\n        p.dim1 = dim1;\n        p.canvasX = dim0.canvasX;\n        p.panelSizeX = dim1.canvasX - dim0.canvasX;\n        p.panelSizeY = vm.model.canvasHeight;\n        p.y = 0;\n        p.canvasY = 0;\n    }\n}\n\nfunction calcAllTicks(cd) {\n    for(var i = 0; i < cd.length; i++) {\n        for(var j = 0; j < cd[i].length; j++) {\n            var trace = cd[i][j].trace;\n            var dimensions = trace.dimensions;\n\n            for(var k = 0; k < dimensions.length; k++) {\n                var values = dimensions[k].values;\n                var dim = dimensions[k]._ax;\n\n                if(dim) {\n                    if(!dim.range) {\n                        dim.range = findExtremes(values, trace._length);\n                    } else {\n                        dim.range = fixExtremes(dim.range[0], dim.range[1]);\n                    }\n\n                    if(!dim.dtick) {\n                        dim.dtick = 0.01 * (Math.abs(dim.range[1] - dim.range[0]) || 1);\n                    }\n\n                    dim.tickformat = dimensions[k].tickformat;\n                    Axes.calcTicks(dim);\n                    dim.cleanRange();\n                }\n            }\n        }\n    }\n}\n\nfunction linearFormat(dim, v) {\n    return Axes.tickText(dim._ax, v, false).text;\n}\n\nfunction extremeText(d, isTop) {\n    if(d.ordinal) return '';\n    var domain = d.domainScale.domain();\n    var v = (domain[isTop ? domain.length - 1 : 0]);\n\n    return linearFormat(d.model.dimensions[d.visibleIndex], v);\n}\n\n\nmodule.exports = function parcoords(gd, cdModule, layout, callbacks) {\n    var fullLayout = gd._fullLayout;\n    var svg = fullLayout._toppaper;\n    var glContainer = fullLayout._glcontainer;\n\n    calcAllTicks(cdModule);\n\n    var state = parcoordsInteractionState();\n\n    var vm = cdModule\n        .filter(function(d) { return unwrap(d).trace.visible; })\n        .map(model.bind(0, layout))\n        .map(viewModel.bind(0, state, callbacks));\n\n    glContainer.each(function(d, i) {\n        return Lib.extendFlat(d, vm[i]);\n    });\n\n    var glLayers = glContainer.selectAll('.gl-canvas')\n        .each(function(d) {\n            // FIXME: figure out how to handle multiple instances\n            d.viewModel = vm[0];\n            d.model = d.viewModel ? d.viewModel.model : null;\n        });\n\n    var lastHovered = null;\n\n    var pickLayer = glLayers.filter(function(d) {return d.pick;});\n\n    // emit hover / unhover event\n    pickLayer\n        .style('pointer-events', 'auto')\n        .on('mousemove', function(d) {\n            if(state.linePickActive() && d.lineLayer && callbacks && callbacks.hover) {\n                var event = d3.event;\n                var cw = this.width;\n                var ch = this.height;\n                var pointer = d3.mouse(this);\n                var x = pointer[0];\n                var y = pointer[1];\n\n                if(x < 0 || y < 0 || x >= cw || y >= ch) {\n                    return;\n                }\n                var pixel = d.lineLayer.readPixel(x, ch - 1 - y);\n                var found = pixel[3] !== 0;\n                // inverse of the calcPickColor in `lines.js`; detailed comment there\n                var curveNumber = found ? pixel[2] + 256 * (pixel[1] + 256 * pixel[0]) : null;\n                var eventData = {\n                    x: x,\n                    y: y,\n                    clientX: event.clientX,\n                    clientY: event.clientY,\n                    dataIndex: d.model.key,\n                    curveNumber: curveNumber\n                };\n                if(curveNumber !== lastHovered) { // don't unnecessarily repeat the same hit (or miss)\n                    if(found) {\n                        callbacks.hover(eventData);\n                    } else if(callbacks.unhover) {\n                        callbacks.unhover(eventData);\n                    }\n                    lastHovered = curveNumber;\n                }\n            }\n        });\n\n    glLayers\n        .style('opacity', function(d) {return d.pick ? 0 : 1;});\n\n    svg.style('background', 'rgba(255, 255, 255, 0)');\n    var controlOverlay = svg.selectAll('.' + c.cn.parcoords)\n        .data(vm, keyFun);\n\n    controlOverlay.exit().remove();\n\n    controlOverlay.enter()\n        .append('g')\n        .classed(c.cn.parcoords, true)\n        .style('shape-rendering', 'crispEdges')\n        .style('pointer-events', 'none');\n\n    controlOverlay.attr('transform', function(d) {\n        return strTranslate(d.model.translateX, d.model.translateY);\n    });\n\n    var parcoordsControlView = controlOverlay.selectAll('.' + c.cn.parcoordsControlView)\n        .data(repeat, keyFun);\n\n    parcoordsControlView.enter()\n        .append('g')\n        .classed(c.cn.parcoordsControlView, true);\n\n    parcoordsControlView.attr('transform', function(d) {\n        return strTranslate(d.model.pad.l, d.model.pad.t);\n    });\n\n    var yAxis = parcoordsControlView.selectAll('.' + c.cn.yAxis)\n        .data(function(p) { return p.dimensions; }, keyFun);\n\n    yAxis.enter()\n        .append('g')\n        .classed(c.cn.yAxis, true);\n\n    parcoordsControlView.each(function(p) {\n        updatePanelLayout(yAxis, p);\n    });\n\n    glLayers\n        .each(function(d) {\n            if(d.viewModel) {\n                if(!d.lineLayer || callbacks) { // recreate in case of having callbacks e.g. restyle. Should we test for callback to be a restyle?\n                    d.lineLayer = lineLayerMaker(this, d);\n                } else d.lineLayer.update(d);\n\n                if(d.key || d.key === 0) d.viewModel[d.key] = d.lineLayer;\n\n                var setChanged = (!d.context || // don't update background\n                                  callbacks);   // unless there is a callback on the context layer. Should we test the callback?\n\n                d.lineLayer.render(d.viewModel.panels, setChanged);\n            }\n        });\n\n    yAxis.attr('transform', function(d) {\n        return strTranslate(d.xScale(d.xIndex), 0);\n    });\n\n    // drag column for reordering columns\n    yAxis.call(d3.behavior.drag()\n        .origin(function(d) { return d; })\n        .on('drag', function(d) {\n            var p = d.parent;\n            state.linePickActive(false);\n            d.x = Math.max(-c.overdrag, Math.min(d.model.width + c.overdrag, d3.event.x));\n            d.canvasX = d.x * d.model.canvasPixelRatio;\n            yAxis\n                .sort(function(a, b) { return a.x - b.x; })\n                .each(function(e, i) {\n                    e.xIndex = i;\n                    e.x = d === e ? e.x : e.xScale(e.xIndex);\n                    e.canvasX = e.x * e.model.canvasPixelRatio;\n                });\n\n            updatePanelLayout(yAxis, p);\n\n            yAxis.filter(function(e) { return Math.abs(d.xIndex - e.xIndex) !== 0; })\n                .attr('transform', function(d) { return strTranslate(d.xScale(d.xIndex), 0); });\n            d3.select(this).attr('transform', strTranslate(d.x, 0));\n            yAxis.each(function(e, i0, i1) { if(i1 === d.parent.key) p.dimensions[i0] = e; });\n            p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n            p.focusLayer.render && p.focusLayer.render(p.panels);\n        })\n        .on('dragend', function(d) {\n            var p = d.parent;\n            d.x = d.xScale(d.xIndex);\n            d.canvasX = d.x * d.model.canvasPixelRatio;\n            updatePanelLayout(yAxis, p);\n            d3.select(this)\n                .attr('transform', function(d) { return strTranslate(d.x, 0); });\n            p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n            p.focusLayer && p.focusLayer.render(p.panels);\n            p.pickLayer && p.pickLayer.render(p.panels, true);\n            state.linePickActive(true);\n\n            if(callbacks && callbacks.axesMoved) {\n                callbacks.axesMoved(p.key, p.dimensions.map(function(e) {return e.crossfilterDimensionIndex;}));\n            }\n        })\n    );\n\n    yAxis.exit()\n        .remove();\n\n    var axisOverlays = yAxis.selectAll('.' + c.cn.axisOverlays)\n        .data(repeat, keyFun);\n\n    axisOverlays.enter()\n        .append('g')\n        .classed(c.cn.axisOverlays, true);\n\n    axisOverlays.selectAll('.' + c.cn.axis).remove();\n\n    var axis = axisOverlays.selectAll('.' + c.cn.axis)\n        .data(repeat, keyFun);\n\n    axis.enter()\n        .append('g')\n        .classed(c.cn.axis, true);\n\n    axis\n        .each(function(d) {\n            var wantedTickCount = d.model.height / d.model.tickDistance;\n            var scale = d.domainScale;\n            var sdom = scale.domain();\n            d3.select(this)\n                .call(d3.svg.axis()\n                    .orient('left')\n                    .tickSize(4)\n                    .outerTickSize(2)\n                    .ticks(wantedTickCount, d.tickFormat) // works for continuous scales only...\n                    .tickValues(d.ordinal ? // and this works for ordinal scales\n                        sdom :\n                        null)\n                    .tickFormat(function(v) {\n                        return helpers.isOrdinal(d) ? v : linearFormat(d.model.dimensions[d.visibleIndex], v);\n                    })\n                    .scale(scale));\n            Drawing.font(axis.selectAll('text'), d.model.tickFont);\n        });\n\n    axis.selectAll('.domain, .tick>line')\n        .attr('fill', 'none')\n        .attr('stroke', 'black')\n        .attr('stroke-opacity', 0.25)\n        .attr('stroke-width', '1px');\n\n    axis.selectAll('text')\n        .style('text-shadow', '1px 1px 1px #fff, -1px -1px 1px #fff, 1px -1px 1px #fff, -1px 1px 1px #fff')\n        .style('cursor', 'default');\n\n    var axisHeading = axisOverlays.selectAll('.' + c.cn.axisHeading)\n        .data(repeat, keyFun);\n\n    axisHeading.enter()\n        .append('g')\n        .classed(c.cn.axisHeading, true);\n\n    var axisTitle = axisHeading.selectAll('.' + c.cn.axisTitle)\n        .data(repeat, keyFun);\n\n    axisTitle.enter()\n        .append('text')\n        .classed(c.cn.axisTitle, true)\n        .attr('text-anchor', 'middle')\n        .style('cursor', 'ew-resize')\n        .style('pointer-events', 'auto');\n\n    axisTitle\n        .text(function(d) { return d.label; })\n        .each(function(d) {\n            var e = d3.select(this);\n            Drawing.font(e, d.model.labelFont);\n            svgTextUtils.convertToTspans(e, gd);\n        })\n        .attr('transform', function(d) {\n            var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n            var r = c.axisTitleOffset;\n            return (\n                (tilt.dir > 0 ? '' : strTranslate(0, 2 * r + d.model.height)) +\n                strRotate(tilt.degrees) +\n                strTranslate(-r * tilt.dx, -r * tilt.dy)\n            );\n        })\n        .attr('text-anchor', function(d) {\n            var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n            var adx = Math.abs(tilt.dx);\n            var ady = Math.abs(tilt.dy);\n\n            if(2 * adx > ady) {\n                return (tilt.dir * tilt.dx < 0) ? 'start' : 'end';\n            } else {\n                return 'middle';\n            }\n        });\n\n    var axisExtent = axisOverlays.selectAll('.' + c.cn.axisExtent)\n        .data(repeat, keyFun);\n\n    axisExtent.enter()\n        .append('g')\n        .classed(c.cn.axisExtent, true);\n\n    var axisExtentTop = axisExtent.selectAll('.' + c.cn.axisExtentTop)\n        .data(repeat, keyFun);\n\n    axisExtentTop.enter()\n        .append('g')\n        .classed(c.cn.axisExtentTop, true);\n\n    axisExtentTop\n        .attr('transform', strTranslate(0, -c.axisExtentOffset));\n\n    var axisExtentTopText = axisExtentTop.selectAll('.' + c.cn.axisExtentTopText)\n        .data(repeat, keyFun);\n\n    axisExtentTopText.enter()\n        .append('text')\n        .classed(c.cn.axisExtentTopText, true)\n        .call(styleExtentTexts);\n\n    axisExtentTopText\n        .text(function(d) { return extremeText(d, true); })\n        .each(function(d) { Drawing.font(d3.select(this), d.model.rangeFont); });\n\n    var axisExtentBottom = axisExtent.selectAll('.' + c.cn.axisExtentBottom)\n        .data(repeat, keyFun);\n\n    axisExtentBottom.enter()\n        .append('g')\n        .classed(c.cn.axisExtentBottom, true);\n\n    axisExtentBottom\n        .attr('transform', function(d) {\n            return strTranslate(0, d.model.height + c.axisExtentOffset);\n        });\n\n    var axisExtentBottomText = axisExtentBottom.selectAll('.' + c.cn.axisExtentBottomText)\n        .data(repeat, keyFun);\n\n    axisExtentBottomText.enter()\n        .append('text')\n        .classed(c.cn.axisExtentBottomText, true)\n        .attr('dy', '0.75em')\n        .call(styleExtentTexts);\n\n    axisExtentBottomText\n        .text(function(d) { return extremeText(d, false); })\n        .each(function(d) { Drawing.font(d3.select(this), d.model.rangeFont); });\n\n    brush.ensureAxisBrush(axisOverlays);\n};\n"]},"metadata":{},"sourceType":"script"}