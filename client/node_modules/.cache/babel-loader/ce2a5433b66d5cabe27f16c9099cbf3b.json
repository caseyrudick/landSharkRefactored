{"ast":null,"code":"\"use strict\";\n\nvar twoProduct = require(\"two-product\");\n\nvar robustSum = require(\"robust-sum\");\n\nvar robustDiff = require(\"robust-subtract\");\n\nvar robustScale = require(\"robust-scale\");\n\nvar NUM_EXPAND = 6;\n\nfunction cofactor(m, c) {\n  var result = new Array(m.length - 1);\n\n  for (var i = 1; i < m.length; ++i) {\n    var r = result[i - 1] = new Array(m.length - 1);\n\n    for (var j = 0, k = 0; j < m.length; ++j) {\n      if (j === c) {\n        continue;\n      }\n\n      r[k++] = m[i][j];\n    }\n  }\n\n  return result;\n}\n\nfunction matrix(n) {\n  var result = new Array(n);\n\n  for (var i = 0; i < n; ++i) {\n    result[i] = new Array(n);\n\n    for (var j = 0; j < n; ++j) {\n      result[i][j] = [\"m\", j, \"[\", n - i - 2, \"]\"].join(\"\");\n    }\n  }\n\n  return result;\n}\n\nfunction generateSum(expr) {\n  if (expr.length === 1) {\n    return expr[0];\n  } else if (expr.length === 2) {\n    return [\"sum(\", expr[0], \",\", expr[1], \")\"].join(\"\");\n  } else {\n    var m = expr.length >> 1;\n    return [\"sum(\", generateSum(expr.slice(0, m)), \",\", generateSum(expr.slice(m)), \")\"].join(\"\");\n  }\n}\n\nfunction makeProduct(a, b) {\n  if (a.charAt(0) === \"m\") {\n    if (b.charAt(0) === \"w\") {\n      var toks = a.split(\"[\");\n      return [\"w\", b.substr(1), \"m\", toks[0].substr(1)].join(\"\");\n    } else {\n      return [\"prod(\", a, \",\", b, \")\"].join(\"\");\n    }\n  } else {\n    return makeProduct(b, a);\n  }\n}\n\nfunction sign(s) {\n  if (s & 1 !== 0) {\n    return \"-\";\n  }\n\n  return \"\";\n}\n\nfunction determinant(m) {\n  if (m.length === 2) {\n    return [[\"diff(\", makeProduct(m[0][0], m[1][1]), \",\", makeProduct(m[1][0], m[0][1]), \")\"].join(\"\")];\n  } else {\n    var expr = [];\n\n    for (var i = 0; i < m.length; ++i) {\n      expr.push([\"scale(\", generateSum(determinant(cofactor(m, i))), \",\", sign(i), m[0][i], \")\"].join(\"\"));\n    }\n\n    return expr;\n  }\n}\n\nfunction makeSquare(d, n) {\n  var terms = [];\n\n  for (var i = 0; i < n - 2; ++i) {\n    terms.push([\"prod(m\", d, \"[\", i, \"],m\", d, \"[\", i, \"])\"].join(\"\"));\n  }\n\n  return generateSum(terms);\n}\n\nfunction orientation(n) {\n  var pos = [];\n  var neg = [];\n  var m = matrix(n);\n\n  for (var i = 0; i < n; ++i) {\n    m[0][i] = \"1\";\n    m[n - 1][i] = \"w\" + i;\n  }\n\n  for (var i = 0; i < n; ++i) {\n    if ((i & 1) === 0) {\n      pos.push.apply(pos, determinant(cofactor(m, i)));\n    } else {\n      neg.push.apply(neg, determinant(cofactor(m, i)));\n    }\n  }\n\n  var posExpr = generateSum(pos);\n  var negExpr = generateSum(neg);\n  var funcName = \"exactInSphere\" + n;\n  var funcArgs = [];\n\n  for (var i = 0; i < n; ++i) {\n    funcArgs.push(\"m\" + i);\n  }\n\n  var code = [\"function \", funcName, \"(\", funcArgs.join(), \"){\"];\n\n  for (var i = 0; i < n; ++i) {\n    code.push(\"var w\", i, \"=\", makeSquare(i, n), \";\");\n\n    for (var j = 0; j < n; ++j) {\n      if (j !== i) {\n        code.push(\"var w\", i, \"m\", j, \"=scale(w\", i, \",m\", j, \"[0]);\");\n      }\n    }\n  }\n\n  code.push(\"var p=\", posExpr, \",n=\", negExpr, \",d=diff(p,n);return d[d.length-1];}return \", funcName);\n  var proc = new Function(\"sum\", \"diff\", \"prod\", \"scale\", code.join(\"\"));\n  return proc(robustSum, robustDiff, twoProduct, robustScale);\n}\n\nfunction inSphere0() {\n  return 0;\n}\n\nfunction inSphere1() {\n  return 0;\n}\n\nfunction inSphere2() {\n  return 0;\n}\n\nvar CACHED = [inSphere0, inSphere1, inSphere2];\n\nfunction slowInSphere(args) {\n  var proc = CACHED[args.length];\n\n  if (!proc) {\n    proc = CACHED[args.length] = orientation(args.length);\n  }\n\n  return proc.apply(undefined, args);\n}\n\nfunction generateInSphereTest() {\n  while (CACHED.length <= NUM_EXPAND) {\n    CACHED.push(orientation(CACHED.length));\n  }\n\n  var args = [];\n  var procArgs = [\"slow\"];\n\n  for (var i = 0; i <= NUM_EXPAND; ++i) {\n    args.push(\"a\" + i);\n    procArgs.push(\"o\" + i);\n  }\n\n  var code = [\"function testInSphere(\", args.join(), \"){switch(arguments.length){case 0:case 1:return 0;\"];\n\n  for (var i = 2; i <= NUM_EXPAND; ++i) {\n    code.push(\"case \", i, \":return o\", i, \"(\", args.slice(0, i).join(), \");\");\n  }\n\n  code.push(\"}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return testInSphere\");\n  procArgs.push(code.join(\"\"));\n  var proc = Function.apply(undefined, procArgs);\n  module.exports = proc.apply(undefined, [slowInSphere].concat(CACHED));\n\n  for (var i = 0; i <= NUM_EXPAND; ++i) {\n    module.exports[i] = CACHED[i];\n  }\n}\n\ngenerateInSphereTest();","map":{"version":3,"sources":["/Users/caseyrudick/Documents/landsharkrefactored-copy/client/node_modules/robust-in-sphere/in-sphere.js"],"names":["twoProduct","require","robustSum","robustDiff","robustScale","NUM_EXPAND","cofactor","m","c","result","Array","length","i","r","j","k","matrix","n","join","generateSum","expr","slice","makeProduct","a","b","charAt","toks","split","substr","sign","s","determinant","push","makeSquare","d","terms","orientation","pos","neg","apply","posExpr","negExpr","funcName","funcArgs","code","proc","Function","inSphere0","inSphere1","inSphere2","CACHED","slowInSphere","args","undefined","generateInSphereTest","procArgs","module","exports","concat"],"mappings":"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","sourcesContent":["\"use strict\"\n\nvar twoProduct = require(\"two-product\")\nvar robustSum = require(\"robust-sum\")\nvar robustDiff = require(\"robust-subtract\")\nvar robustScale = require(\"robust-scale\")\n\nvar NUM_EXPAND = 6\n\nfunction cofactor(m, c) {\n  var result = new Array(m.length-1)\n  for(var i=1; i<m.length; ++i) {\n    var r = result[i-1] = new Array(m.length-1)\n    for(var j=0,k=0; j<m.length; ++j) {\n      if(j === c) {\n        continue\n      }\n      r[k++] = m[i][j]\n    }\n  }\n  return result\n}\n\nfunction matrix(n) {\n  var result = new Array(n)\n  for(var i=0; i<n; ++i) {\n    result[i] = new Array(n)\n    for(var j=0; j<n; ++j) {\n      result[i][j] = [\"m\", j, \"[\", (n-i-2), \"]\"].join(\"\")\n    }\n  }\n  return result\n}\n\nfunction generateSum(expr) {\n  if(expr.length === 1) {\n    return expr[0]\n  } else if(expr.length === 2) {\n    return [\"sum(\", expr[0], \",\", expr[1], \")\"].join(\"\")\n  } else {\n    var m = expr.length>>1\n    return [\"sum(\", generateSum(expr.slice(0, m)), \",\", generateSum(expr.slice(m)), \")\"].join(\"\")\n  }\n}\n\nfunction makeProduct(a, b) {\n  if(a.charAt(0) === \"m\") {\n    if(b.charAt(0) === \"w\") {\n      var toks = a.split(\"[\")\n      return [\"w\", b.substr(1), \"m\", toks[0].substr(1)].join(\"\")\n    } else {\n      return [\"prod(\", a, \",\", b, \")\"].join(\"\")\n    }\n  } else {\n    return makeProduct(b, a)\n  }\n}\n\nfunction sign(s) {\n  if(s & 1 !== 0) {\n    return \"-\"\n  }\n  return \"\"\n}\n\nfunction determinant(m) {\n  if(m.length === 2) {\n    return [[\"diff(\", makeProduct(m[0][0], m[1][1]), \",\", makeProduct(m[1][0], m[0][1]), \")\"].join(\"\")]\n  } else {\n    var expr = []\n    for(var i=0; i<m.length; ++i) {\n      expr.push([\"scale(\", generateSum(determinant(cofactor(m, i))), \",\", sign(i), m[0][i], \")\"].join(\"\"))\n    }\n    return expr\n  }\n}\n\nfunction makeSquare(d, n) {\n  var terms = []\n  for(var i=0; i<n-2; ++i) {\n    terms.push([\"prod(m\", d, \"[\", i, \"],m\", d, \"[\", i, \"])\"].join(\"\"))\n  }\n  return generateSum(terms)\n}\n\nfunction orientation(n) {\n  var pos = []\n  var neg = []\n  var m = matrix(n)\n  for(var i=0; i<n; ++i) {\n    m[0][i] = \"1\"\n    m[n-1][i] = \"w\"+i\n  } \n  for(var i=0; i<n; ++i) {\n    if((i&1)===0) {\n      pos.push.apply(pos,determinant(cofactor(m, i)))\n    } else {\n      neg.push.apply(neg,determinant(cofactor(m, i)))\n    }\n  }\n  var posExpr = generateSum(pos)\n  var negExpr = generateSum(neg)\n  var funcName = \"exactInSphere\" + n\n  var funcArgs = []\n  for(var i=0; i<n; ++i) {\n    funcArgs.push(\"m\" + i)\n  }\n  var code = [\"function \", funcName, \"(\", funcArgs.join(), \"){\"]\n  for(var i=0; i<n; ++i) {\n    code.push(\"var w\",i,\"=\",makeSquare(i,n),\";\")\n    for(var j=0; j<n; ++j) {\n      if(j !== i) {\n        code.push(\"var w\",i,\"m\",j,\"=scale(w\",i,\",m\",j,\"[0]);\")\n      }\n    }\n  }\n  code.push(\"var p=\", posExpr, \",n=\", negExpr, \",d=diff(p,n);return d[d.length-1];}return \", funcName)\n  var proc = new Function(\"sum\", \"diff\", \"prod\", \"scale\", code.join(\"\"))\n  return proc(robustSum, robustDiff, twoProduct, robustScale)\n}\n\nfunction inSphere0() { return 0 }\nfunction inSphere1() { return 0 }\nfunction inSphere2() { return 0 }\n\nvar CACHED = [\n  inSphere0,\n  inSphere1,\n  inSphere2\n]\n\nfunction slowInSphere(args) {\n  var proc = CACHED[args.length]\n  if(!proc) {\n    proc = CACHED[args.length] = orientation(args.length)\n  }\n  return proc.apply(undefined, args)\n}\n\nfunction generateInSphereTest() {\n  while(CACHED.length <= NUM_EXPAND) {\n    CACHED.push(orientation(CACHED.length))\n  }\n  var args = []\n  var procArgs = [\"slow\"]\n  for(var i=0; i<=NUM_EXPAND; ++i) {\n    args.push(\"a\" + i)\n    procArgs.push(\"o\" + i)\n  }\n  var code = [\n    \"function testInSphere(\", args.join(), \"){switch(arguments.length){case 0:case 1:return 0;\"\n  ]\n  for(var i=2; i<=NUM_EXPAND; ++i) {\n    code.push(\"case \", i, \":return o\", i, \"(\", args.slice(0, i).join(), \");\")\n  }\n  code.push(\"}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return testInSphere\")\n  procArgs.push(code.join(\"\"))\n\n  var proc = Function.apply(undefined, procArgs)\n\n  module.exports = proc.apply(undefined, [slowInSphere].concat(CACHED))\n  for(var i=0; i<=NUM_EXPAND; ++i) {\n    module.exports[i] = CACHED[i]\n  }\n}\n\ngenerateInSphereTest()"]},"metadata":{},"sourceType":"script"}