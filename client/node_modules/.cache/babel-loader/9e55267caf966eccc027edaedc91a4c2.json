{"ast":null,"code":"/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar d3 = require('d3');\n\nvar Registry = require('../../registry');\n\nvar appendArrayPointValue = require('../../components/fx/helpers').appendArrayPointValue;\n\nvar Fx = require('../../components/fx');\n\nvar Lib = require('../../lib');\n\nvar Events = require('../../lib/events');\n\nvar helpers = require('./helpers');\n\nvar pieHelpers = require('../pie/helpers');\n\nvar formatValue = pieHelpers.formatPieValue;\n\nmodule.exports = function attachFxHandlers(sliceTop, entry, gd, cd, opts) {\n  var cd0 = cd[0];\n  var trace = cd0.trace;\n  var hierarchy = cd0.hierarchy;\n  var isSunburst = trace.type === 'sunburst';\n  var isTreemap = trace.type === 'treemap'; // hover state vars\n  // have we drawn a hover label, so it should be cleared later\n\n  if (!('_hasHoverLabel' in trace)) trace._hasHoverLabel = false; // have we emitted a hover event, so later an unhover event should be emitted\n  // note that click events do not depend on this - you can still get them\n  // with hovermode: false or if you were earlier dragging, then clicked\n  // in the same slice that you moused up in\n\n  if (!('_hasHoverEvent' in trace)) trace._hasHoverEvent = false;\n\n  var onMouseOver = function (pt) {\n    var fullLayoutNow = gd._fullLayout;\n    if (gd._dragging || fullLayoutNow.hovermode === false) return;\n    var traceNow = gd._fullData[trace.index];\n    var cdi = pt.data.data;\n    var ptNumber = cdi.i;\n    var isRoot = helpers.isHierarchyRoot(pt);\n    var parent = helpers.getParent(hierarchy, pt);\n    var val = helpers.getValue(pt);\n\n    var _cast = function (astr) {\n      return Lib.castOption(traceNow, ptNumber, astr);\n    };\n\n    var hovertemplate = _cast('hovertemplate');\n\n    var hoverinfo = Fx.castHoverinfo(traceNow, fullLayoutNow, ptNumber);\n    var separators = fullLayoutNow.separators;\n\n    if (hovertemplate || hoverinfo && hoverinfo !== 'none' && hoverinfo !== 'skip') {\n      var hoverCenterX;\n      var hoverCenterY;\n\n      if (isSunburst) {\n        hoverCenterX = cd0.cx + pt.pxmid[0] * (1 - pt.rInscribed);\n        hoverCenterY = cd0.cy + pt.pxmid[1] * (1 - pt.rInscribed);\n      }\n\n      if (isTreemap) {\n        hoverCenterX = pt._hoverX;\n        hoverCenterY = pt._hoverY;\n      }\n\n      var hoverPt = {};\n      var parts = [];\n      var thisText = [];\n\n      var hasFlag = function (flag) {\n        return parts.indexOf(flag) !== -1;\n      };\n\n      if (hoverinfo) {\n        parts = hoverinfo === 'all' ? traceNow._module.attributes.hoverinfo.flags : hoverinfo.split('+');\n      }\n\n      hoverPt.label = cdi.label;\n      if (hasFlag('label') && hoverPt.label) thisText.push(hoverPt.label);\n\n      if (cdi.hasOwnProperty('v')) {\n        hoverPt.value = cdi.v;\n        hoverPt.valueLabel = formatValue(hoverPt.value, separators);\n        if (hasFlag('value')) thisText.push(hoverPt.valueLabel);\n      }\n\n      hoverPt.currentPath = pt.currentPath = helpers.getPath(pt.data);\n\n      if (hasFlag('current path') && !isRoot) {\n        thisText.push(hoverPt.currentPath);\n      }\n\n      var tx;\n      var allPercents = [];\n\n      var insertPercent = function () {\n        if (allPercents.indexOf(tx) === -1) {\n          // no need to add redundant info\n          thisText.push(tx);\n          allPercents.push(tx);\n        }\n      };\n\n      hoverPt.percentParent = pt.percentParent = val / helpers.getValue(parent);\n      hoverPt.parent = pt.parentString = helpers.getPtLabel(parent);\n\n      if (hasFlag('percent parent')) {\n        tx = helpers.formatPercent(hoverPt.percentParent, separators) + ' of ' + hoverPt.parent;\n        insertPercent();\n      }\n\n      hoverPt.percentEntry = pt.percentEntry = val / helpers.getValue(entry);\n      hoverPt.entry = pt.entry = helpers.getPtLabel(entry);\n\n      if (hasFlag('percent entry') && !isRoot && !pt.onPathbar) {\n        tx = helpers.formatPercent(hoverPt.percentEntry, separators) + ' of ' + hoverPt.entry;\n        insertPercent();\n      }\n\n      hoverPt.percentRoot = pt.percentRoot = val / helpers.getValue(hierarchy);\n      hoverPt.root = pt.root = helpers.getPtLabel(hierarchy);\n\n      if (hasFlag('percent root') && !isRoot) {\n        tx = helpers.formatPercent(hoverPt.percentRoot, separators) + ' of ' + hoverPt.root;\n        insertPercent();\n      }\n\n      hoverPt.text = _cast('hovertext') || _cast('text');\n\n      if (hasFlag('text')) {\n        tx = hoverPt.text;\n        if (Lib.isValidTextValue(tx)) thisText.push(tx);\n      }\n\n      var hoverItems = {\n        trace: traceNow,\n        y: hoverCenterY,\n        text: thisText.join('<br>'),\n        name: hovertemplate || hasFlag('name') ? traceNow.name : undefined,\n        color: _cast('hoverlabel.bgcolor') || cdi.color,\n        borderColor: _cast('hoverlabel.bordercolor'),\n        fontFamily: _cast('hoverlabel.font.family'),\n        fontSize: _cast('hoverlabel.font.size'),\n        fontColor: _cast('hoverlabel.font.color'),\n        nameLength: _cast('hoverlabel.namelength'),\n        textAlign: _cast('hoverlabel.align'),\n        hovertemplate: hovertemplate,\n        hovertemplateLabels: hoverPt,\n        eventData: [makeEventData(pt, traceNow, opts.eventDataKeys)]\n      };\n\n      if (isSunburst) {\n        hoverItems.x0 = hoverCenterX - pt.rInscribed * pt.rpx1;\n        hoverItems.x1 = hoverCenterX + pt.rInscribed * pt.rpx1;\n        hoverItems.idealAlign = pt.pxmid[0] < 0 ? 'left' : 'right';\n      }\n\n      if (isTreemap) {\n        hoverItems.x = hoverCenterX;\n        hoverItems.idealAlign = hoverCenterX < 0 ? 'left' : 'right';\n      }\n\n      Fx.loneHover(hoverItems, {\n        container: fullLayoutNow._hoverlayer.node(),\n        outerContainer: fullLayoutNow._paper.node(),\n        gd: gd\n      });\n      trace._hasHoverLabel = true;\n    }\n\n    if (isTreemap) {\n      var slice = sliceTop.select('path.surface');\n      opts.styleOne(slice, pt, traceNow, {\n        hovered: true\n      });\n    }\n\n    trace._hasHoverEvent = true;\n    gd.emit('plotly_hover', {\n      points: [makeEventData(pt, traceNow, opts.eventDataKeys)],\n      event: d3.event\n    });\n  };\n\n  var onMouseOut = function (evt) {\n    var fullLayoutNow = gd._fullLayout;\n    var traceNow = gd._fullData[trace.index];\n    var pt = d3.select(this).datum();\n\n    if (trace._hasHoverEvent) {\n      evt.originalEvent = d3.event;\n      gd.emit('plotly_unhover', {\n        points: [makeEventData(pt, traceNow, opts.eventDataKeys)],\n        event: d3.event\n      });\n      trace._hasHoverEvent = false;\n    }\n\n    if (trace._hasHoverLabel) {\n      Fx.loneUnhover(fullLayoutNow._hoverlayer.node());\n      trace._hasHoverLabel = false;\n    }\n\n    if (isTreemap) {\n      var slice = sliceTop.select('path.surface');\n      opts.styleOne(slice, pt, traceNow, {\n        hovered: false\n      });\n    }\n  };\n\n  var onClick = function (pt) {\n    // TODO: this does not support right-click. If we want to support it, we\n    // would likely need to change pie to use dragElement instead of straight\n    // mapbox event binding. Or perhaps better, make a simple wrapper with the\n    // right mousedown, mousemove, and mouseup handlers just for a left/right click\n    // mapbox would use this too.\n    var fullLayoutNow = gd._fullLayout;\n    var traceNow = gd._fullData[trace.index];\n    var noTransition = isSunburst && (helpers.isHierarchyRoot(pt) || helpers.isLeaf(pt));\n    var id = helpers.getPtId(pt);\n    var nextEntry = helpers.isEntry(pt) ? helpers.findEntryWithChild(hierarchy, id) : helpers.findEntryWithLevel(hierarchy, id);\n    var nextLevel = helpers.getPtId(nextEntry);\n    var typeClickEvtData = {\n      points: [makeEventData(pt, traceNow, opts.eventDataKeys)],\n      event: d3.event\n    };\n    if (!noTransition) typeClickEvtData.nextLevel = nextLevel;\n    var clickVal = Events.triggerHandler(gd, 'plotly_' + trace.type + 'click', typeClickEvtData);\n\n    if (clickVal !== false && fullLayoutNow.hovermode) {\n      gd._hoverdata = [makeEventData(pt, traceNow, opts.eventDataKeys)];\n      Fx.click(gd, d3.event);\n    } // if click does not trigger a transition, we're done!\n\n\n    if (noTransition) return; // if custom handler returns false, we're done!\n\n    if (clickVal === false) return; // skip if triggered from dragging a nearby cartesian subplot\n\n    if (gd._dragging) return; // skip during transitions, to avoid potential bugs\n    // we could remove this check later\n\n    if (gd._transitioning) return; // store 'old' level in guiEdit stash, so that subsequent Plotly.react\n    // calls with the same uirevision can start from the same entry\n\n    Registry.call('_storeDirectGUIEdit', traceNow, fullLayoutNow._tracePreGUI[traceNow.uid], {\n      level: traceNow.level\n    });\n    var frame = {\n      data: [{\n        level: nextLevel\n      }],\n      traces: [trace.index]\n    };\n    var animOpts = {\n      frame: {\n        redraw: false,\n        duration: opts.transitionTime\n      },\n      transition: {\n        duration: opts.transitionTime,\n        easing: opts.transitionEasing\n      },\n      mode: 'immediate',\n      fromcurrent: true\n    };\n    Fx.loneUnhover(fullLayoutNow._hoverlayer.node());\n    Registry.call('animate', gd, frame, animOpts);\n  };\n\n  sliceTop.on('mouseover', onMouseOver);\n  sliceTop.on('mouseout', onMouseOut);\n  sliceTop.on('click', onClick);\n};\n\nfunction makeEventData(pt, trace, keys) {\n  var cdi = pt.data.data;\n  var out = {\n    curveNumber: trace.index,\n    pointNumber: cdi.i,\n    data: trace._input,\n    fullData: trace // TODO more things like 'children', 'siblings', 'hierarchy?\n\n  };\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (key in pt) out[key] = pt[key];\n  } // handle special case of parent\n\n\n  if ('parentString' in pt && !helpers.isHierarchyRoot(pt)) out.parent = pt.parentString;\n  appendArrayPointValue(out, trace, cdi.i);\n  return out;\n}","map":{"version":3,"sources":["/Users/caseyrudick/Documents/landsharkrefactored-copy/client/node_modules/plotly.js/src/traces/sunburst/fx.js"],"names":["d3","require","Registry","appendArrayPointValue","Fx","Lib","Events","helpers","pieHelpers","formatValue","formatPieValue","module","exports","attachFxHandlers","sliceTop","entry","gd","cd","opts","cd0","trace","hierarchy","isSunburst","type","isTreemap","_hasHoverLabel","_hasHoverEvent","onMouseOver","pt","fullLayoutNow","_fullLayout","_dragging","hovermode","traceNow","_fullData","index","cdi","data","ptNumber","i","isRoot","isHierarchyRoot","parent","getParent","val","getValue","_cast","astr","castOption","hovertemplate","hoverinfo","castHoverinfo","separators","hoverCenterX","hoverCenterY","cx","pxmid","rInscribed","cy","_hoverX","_hoverY","hoverPt","parts","thisText","hasFlag","flag","indexOf","_module","attributes","flags","split","label","push","hasOwnProperty","value","v","valueLabel","currentPath","getPath","tx","allPercents","insertPercent","percentParent","parentString","getPtLabel","formatPercent","percentEntry","onPathbar","percentRoot","root","text","isValidTextValue","hoverItems","y","join","name","undefined","color","borderColor","fontFamily","fontSize","fontColor","nameLength","textAlign","hovertemplateLabels","eventData","makeEventData","eventDataKeys","x0","rpx1","x1","idealAlign","x","loneHover","container","_hoverlayer","node","outerContainer","_paper","slice","select","styleOne","hovered","emit","points","event","onMouseOut","evt","datum","originalEvent","loneUnhover","onClick","noTransition","isLeaf","id","getPtId","nextEntry","isEntry","findEntryWithChild","findEntryWithLevel","nextLevel","typeClickEvtData","clickVal","triggerHandler","_hoverdata","click","_transitioning","call","_tracePreGUI","uid","level","frame","traces","animOpts","redraw","duration","transitionTime","transition","easing","transitionEasing","mode","fromcurrent","on","keys","out","curveNumber","pointNumber","_input","fullData","length","key"],"mappings":"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","sourcesContent":["/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar d3 = require('d3');\nvar Registry = require('../../registry');\nvar appendArrayPointValue = require('../../components/fx/helpers').appendArrayPointValue;\nvar Fx = require('../../components/fx');\nvar Lib = require('../../lib');\nvar Events = require('../../lib/events');\n\nvar helpers = require('./helpers');\nvar pieHelpers = require('../pie/helpers');\n\nvar formatValue = pieHelpers.formatPieValue;\n\nmodule.exports = function attachFxHandlers(sliceTop, entry, gd, cd, opts) {\n    var cd0 = cd[0];\n    var trace = cd0.trace;\n    var hierarchy = cd0.hierarchy;\n\n    var isSunburst = trace.type === 'sunburst';\n    var isTreemap = trace.type === 'treemap';\n\n    // hover state vars\n    // have we drawn a hover label, so it should be cleared later\n    if(!('_hasHoverLabel' in trace)) trace._hasHoverLabel = false;\n    // have we emitted a hover event, so later an unhover event should be emitted\n    // note that click events do not depend on this - you can still get them\n    // with hovermode: false or if you were earlier dragging, then clicked\n    // in the same slice that you moused up in\n    if(!('_hasHoverEvent' in trace)) trace._hasHoverEvent = false;\n\n    var onMouseOver = function(pt) {\n        var fullLayoutNow = gd._fullLayout;\n\n        if(gd._dragging || fullLayoutNow.hovermode === false) return;\n\n        var traceNow = gd._fullData[trace.index];\n        var cdi = pt.data.data;\n        var ptNumber = cdi.i;\n        var isRoot = helpers.isHierarchyRoot(pt);\n        var parent = helpers.getParent(hierarchy, pt);\n\n        var val = helpers.getValue(pt);\n\n        var _cast = function(astr) {\n            return Lib.castOption(traceNow, ptNumber, astr);\n        };\n\n        var hovertemplate = _cast('hovertemplate');\n        var hoverinfo = Fx.castHoverinfo(traceNow, fullLayoutNow, ptNumber);\n        var separators = fullLayoutNow.separators;\n\n        if(hovertemplate || (hoverinfo && hoverinfo !== 'none' && hoverinfo !== 'skip')) {\n            var hoverCenterX;\n            var hoverCenterY;\n            if(isSunburst) {\n                hoverCenterX = cd0.cx + pt.pxmid[0] * (1 - pt.rInscribed);\n                hoverCenterY = cd0.cy + pt.pxmid[1] * (1 - pt.rInscribed);\n            }\n            if(isTreemap) {\n                hoverCenterX = pt._hoverX;\n                hoverCenterY = pt._hoverY;\n            }\n\n            var hoverPt = {};\n            var parts = [];\n            var thisText = [];\n            var hasFlag = function(flag) { return parts.indexOf(flag) !== -1; };\n\n            if(hoverinfo) {\n                parts = hoverinfo === 'all' ?\n                    traceNow._module.attributes.hoverinfo.flags :\n                    hoverinfo.split('+');\n            }\n\n            hoverPt.label = cdi.label;\n            if(hasFlag('label') && hoverPt.label) thisText.push(hoverPt.label);\n\n            if(cdi.hasOwnProperty('v')) {\n                hoverPt.value = cdi.v;\n                hoverPt.valueLabel = formatValue(hoverPt.value, separators);\n                if(hasFlag('value')) thisText.push(hoverPt.valueLabel);\n            }\n\n            hoverPt.currentPath = pt.currentPath = helpers.getPath(pt.data);\n            if(hasFlag('current path') && !isRoot) {\n                thisText.push(hoverPt.currentPath);\n            }\n\n            var tx;\n            var allPercents = [];\n            var insertPercent = function() {\n                if(allPercents.indexOf(tx) === -1) { // no need to add redundant info\n                    thisText.push(tx);\n                    allPercents.push(tx);\n                }\n            };\n\n            hoverPt.percentParent = pt.percentParent = val / helpers.getValue(parent);\n            hoverPt.parent = pt.parentString = helpers.getPtLabel(parent);\n            if(hasFlag('percent parent')) {\n                tx = helpers.formatPercent(hoverPt.percentParent, separators) + ' of ' + hoverPt.parent;\n                insertPercent();\n            }\n\n            hoverPt.percentEntry = pt.percentEntry = val / helpers.getValue(entry);\n            hoverPt.entry = pt.entry = helpers.getPtLabel(entry);\n            if(hasFlag('percent entry') && !isRoot && !pt.onPathbar) {\n                tx = helpers.formatPercent(hoverPt.percentEntry, separators) + ' of ' + hoverPt.entry;\n                insertPercent();\n            }\n\n            hoverPt.percentRoot = pt.percentRoot = val / helpers.getValue(hierarchy);\n            hoverPt.root = pt.root = helpers.getPtLabel(hierarchy);\n            if(hasFlag('percent root') && !isRoot) {\n                tx = helpers.formatPercent(hoverPt.percentRoot, separators) + ' of ' + hoverPt.root;\n                insertPercent();\n            }\n\n            hoverPt.text = _cast('hovertext') || _cast('text');\n            if(hasFlag('text')) {\n                tx = hoverPt.text;\n                if(Lib.isValidTextValue(tx)) thisText.push(tx);\n            }\n\n            var hoverItems = {\n                trace: traceNow,\n                y: hoverCenterY,\n                text: thisText.join('<br>'),\n                name: (hovertemplate || hasFlag('name')) ? traceNow.name : undefined,\n                color: _cast('hoverlabel.bgcolor') || cdi.color,\n                borderColor: _cast('hoverlabel.bordercolor'),\n                fontFamily: _cast('hoverlabel.font.family'),\n                fontSize: _cast('hoverlabel.font.size'),\n                fontColor: _cast('hoverlabel.font.color'),\n                nameLength: _cast('hoverlabel.namelength'),\n                textAlign: _cast('hoverlabel.align'),\n                hovertemplate: hovertemplate,\n                hovertemplateLabels: hoverPt,\n                eventData: [makeEventData(pt, traceNow, opts.eventDataKeys)]\n            };\n\n            if(isSunburst) {\n                hoverItems.x0 = hoverCenterX - pt.rInscribed * pt.rpx1;\n                hoverItems.x1 = hoverCenterX + pt.rInscribed * pt.rpx1;\n                hoverItems.idealAlign = pt.pxmid[0] < 0 ? 'left' : 'right';\n            }\n            if(isTreemap) {\n                hoverItems.x = hoverCenterX;\n                hoverItems.idealAlign = hoverCenterX < 0 ? 'left' : 'right';\n            }\n\n            Fx.loneHover(hoverItems, {\n                container: fullLayoutNow._hoverlayer.node(),\n                outerContainer: fullLayoutNow._paper.node(),\n                gd: gd\n            });\n\n            trace._hasHoverLabel = true;\n        }\n\n        if(isTreemap) {\n            var slice = sliceTop.select('path.surface');\n            opts.styleOne(slice, pt, traceNow, {\n                hovered: true\n            });\n        }\n\n        trace._hasHoverEvent = true;\n        gd.emit('plotly_hover', {\n            points: [makeEventData(pt, traceNow, opts.eventDataKeys)],\n            event: d3.event\n        });\n    };\n\n    var onMouseOut = function(evt) {\n        var fullLayoutNow = gd._fullLayout;\n        var traceNow = gd._fullData[trace.index];\n        var pt = d3.select(this).datum();\n\n        if(trace._hasHoverEvent) {\n            evt.originalEvent = d3.event;\n            gd.emit('plotly_unhover', {\n                points: [makeEventData(pt, traceNow, opts.eventDataKeys)],\n                event: d3.event\n            });\n            trace._hasHoverEvent = false;\n        }\n\n        if(trace._hasHoverLabel) {\n            Fx.loneUnhover(fullLayoutNow._hoverlayer.node());\n            trace._hasHoverLabel = false;\n        }\n\n        if(isTreemap) {\n            var slice = sliceTop.select('path.surface');\n            opts.styleOne(slice, pt, traceNow, {\n                hovered: false\n            });\n        }\n    };\n\n    var onClick = function(pt) {\n        // TODO: this does not support right-click. If we want to support it, we\n        // would likely need to change pie to use dragElement instead of straight\n        // mapbox event binding. Or perhaps better, make a simple wrapper with the\n        // right mousedown, mousemove, and mouseup handlers just for a left/right click\n        // mapbox would use this too.\n        var fullLayoutNow = gd._fullLayout;\n        var traceNow = gd._fullData[trace.index];\n\n        var noTransition = isSunburst && (helpers.isHierarchyRoot(pt) || helpers.isLeaf(pt));\n\n        var id = helpers.getPtId(pt);\n        var nextEntry = helpers.isEntry(pt) ?\n            helpers.findEntryWithChild(hierarchy, id) :\n            helpers.findEntryWithLevel(hierarchy, id);\n        var nextLevel = helpers.getPtId(nextEntry);\n\n        var typeClickEvtData = {\n            points: [makeEventData(pt, traceNow, opts.eventDataKeys)],\n            event: d3.event\n        };\n        if(!noTransition) typeClickEvtData.nextLevel = nextLevel;\n\n        var clickVal = Events.triggerHandler(gd, 'plotly_' + trace.type + 'click', typeClickEvtData);\n\n        if(clickVal !== false && fullLayoutNow.hovermode) {\n            gd._hoverdata = [makeEventData(pt, traceNow, opts.eventDataKeys)];\n            Fx.click(gd, d3.event);\n        }\n\n        // if click does not trigger a transition, we're done!\n        if(noTransition) return;\n\n        // if custom handler returns false, we're done!\n        if(clickVal === false) return;\n\n        // skip if triggered from dragging a nearby cartesian subplot\n        if(gd._dragging) return;\n\n        // skip during transitions, to avoid potential bugs\n        // we could remove this check later\n        if(gd._transitioning) return;\n\n        // store 'old' level in guiEdit stash, so that subsequent Plotly.react\n        // calls with the same uirevision can start from the same entry\n        Registry.call('_storeDirectGUIEdit', traceNow, fullLayoutNow._tracePreGUI[traceNow.uid], {\n            level: traceNow.level\n        });\n\n        var frame = {\n            data: [{level: nextLevel}],\n            traces: [trace.index]\n        };\n\n        var animOpts = {\n            frame: {\n                redraw: false,\n                duration: opts.transitionTime\n            },\n            transition: {\n                duration: opts.transitionTime,\n                easing: opts.transitionEasing\n            },\n            mode: 'immediate',\n            fromcurrent: true\n        };\n\n        Fx.loneUnhover(fullLayoutNow._hoverlayer.node());\n        Registry.call('animate', gd, frame, animOpts);\n    };\n\n    sliceTop.on('mouseover', onMouseOver);\n    sliceTop.on('mouseout', onMouseOut);\n    sliceTop.on('click', onClick);\n};\n\nfunction makeEventData(pt, trace, keys) {\n    var cdi = pt.data.data;\n\n    var out = {\n        curveNumber: trace.index,\n        pointNumber: cdi.i,\n        data: trace._input,\n        fullData: trace,\n\n        // TODO more things like 'children', 'siblings', 'hierarchy?\n    };\n\n    for(var i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        if(key in pt) out[key] = pt[key];\n    }\n    // handle special case of parent\n    if('parentString' in pt && !helpers.isHierarchyRoot(pt)) out.parent = pt.parentString;\n\n    appendArrayPointValue(out, trace, cdi.i);\n\n    return out;\n}\n"]},"metadata":{},"sourceType":"script"}